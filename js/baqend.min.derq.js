!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.baqend=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a){var b=a("./EntityManagerFactory").EntityManagerFactory,c="undefined"!=typeof window?window:global,d=c.DB,e=c.DB={_promise:null,ready:function(a){return e._location||e.connect(window.location.protocol+"//"+window.location.host),e._promise.then(a)},connect:function(a,d){if(this._location)throw new Error("DB already initialized.");return this._location=a,e._location=a,e._promise=new b(a).createEntityManager().then(function(a){return c.DB=a}),this.ready(d)}};d&&d._callbacks&&(d._location&&e.connect(d._location),d._callbacks.forEach(e.ready))},{"./EntityManagerFactory":3}],2:[function(a,b,c){var d=a("node-uuid"),e=a("./util"),f=a("./message"),g=a("./error"),h=a("./EntityTransaction").EntityTransaction,i=a("./Query").Query,j=a("./TypedQuery").TypedQuery,k=a("./util").Validator,l=a("./util").ValidationResult,m=a("./connector/Message").Message.StatusCode;c.EntityManager=EntityManager=Object.inherit({entityManagerFactory:null,metamodel:null,code:null,_readyPromise:Promise.resolve(null),_connector:null,_entities:null,get isOpen(){return!!this._connector},token:null,me:null,User:null,get isGlobal(){return DB==this},run:function(a,b,c,d){return Function.isInstance(b)&&(d=c,c=b,b=null),this.code.callCode(a,b,this.token).then(c,d)},initialize:function(a){this._connector=a._connector,this._entities={},this.entityManagerFactory=a,this.metamodel=a.metamodel,this.code=a.code,this._createObjectFactory(this.metamodel.embeddables),this._createObjectFactory(this.metamodel.entities),this.transaction=new h(this)},_createObjectFactory:function(a){Object.keys(a).forEach(function(a){var b=this.metamodel.managedType(a),c=b.isNative?b.name.substring(8):b.name;Object.defineProperty(this,c,{get:function(){return Object.defineProperty(this,c,{value:b.createObjectFactory(this)}),this[c]},set:function(a){b.typeConstructor=a},configurable:!0})},this)},_send:function(a){return a.withAuthorizationToken(this.isGlobal||this.token),this._connector.send(a).then(function(){var b=a.getAuthorizationToken();return b&&(this.token=b),a}.bind(this))},ready:function(a){var b=this;return this._readyPromise.then(function(){return b},function(){return b}).then(a)},withLock:function(a){if(this._isLocked)throw new Error("Current operation has not been finished.");return this._isLocked=!0,this._readyPromise=a().then(function(a){return this._isLocked=!1,a}.bind(this),function(a){throw this._isLocked=!1,a}.bind(this))},getReference:function(a,b){if(String.isInstance(a)&&!b){var c=a.lastIndexOf("/");b=decodeURIComponent(a.substring(c+1)),a=a.substring(0,c)}var d=this.metamodel.entity(a),f=this._entities[d.ref+"/"+encodeURIComponent(b)];if(!f){f=d.create();var g=e.Metadata.get(f);g.id=b,g.setUnavailable(),this._attach(f)}return f},createQuery:function(a,b){return b?new j(this,a,b):new i(this,a)},clear:function(){return this.yield().then(function(){for(var a in this._entities)this.removeReference(this._entities[a])}.bind(this))},close:function(a,b){return this._connector=null,this.clear(a,b)},contains:function(a){var b=e.Metadata.get(a);return!!b&&this._entities[b.ref]===a},containsById:function(a){var b=this.metamodel.entity(a.constructor),c=b.ref+"/"+a.id;return!!this._entities[c]},detach:function(a){return a.withLock(function(){return this.removeReference(a),a})},find:function(a,b,c,d,g){var g=g||[],h=this.getReference(a,b),i=e.Metadata.get(h),j=new f.GetObject(i.bucket,i.id);return(i.version||c)&&j.setIfNoneMatch(c?"":i.version),this._send(j).then(function(a){a.response.statusCode!=m.NOT_MODIFIED&&i.setDatabaseObject(a.response.entity),i.setPersistent();var b=[];return d&&this.getSubEntities(h,1).forEach(function(a){if(!~g.indexOf(a)){g.push(a);var f=e.Metadata.get(a);b.push(this.find(a.constructor,f.id,c,d===!0?d:d-1,g))}}.bind(this)),Promise.all(b).then(function(){return h})}.bind(this),function(a){if(a.statusCode==m.OBJECT_NOT_FOUND)return this.removeReference(h),i.setRemoved(),null;throw a}.bind(this))},insert:function(a,b,c){var d;return this._save(a,b,c,function(a){if(a.version)throw new Error("Existing objects can't be inserted.");return d=!a.id,new f.CreateObject(a.bucket,a.getDatabaseObject())}).then(function(b){return d&&this._attach(a),b}.bind(this))},update:function(a,b,c,d){return this._save(a,b,d,function(a){if(!a.version)throw new Error("New objects can't be inserted.");if(c){var b=new f.ReplaceObject(a.bucket,a.id,a.getDatabaseObject(!0));return b.setIfMatch("*"),b}return b=new f.ReplaceObject(a.bucket,a.id,a.getDatabaseObject(!1)),b.setIfMatch(a.version),b})},save:function(a,b,c,d){return this._save(a,b,d,function(a){if(c){if(!a.id)throw new Error("New special objects can't be forcedly saved.");return new f.ReplaceObject(a.bucket,a.id,a.getDatabaseObject(!0))}if(a.version){var b=new f.ReplaceObject(a.bucket,a.id,a.getDatabaseObject(!1));return b.setIfMatch(a.version),b}return new f.CreateObject(a.bucket,a.getDatabaseObject())})},_save:function(a,b,c,d){return this.attach(a),a.withLock(function(){var f=e.Metadata.get(a),g=[];if(this.getSubEntities(a,c).forEach(function(a){g.push(this._save(a,b,0,d))}.bind(this)),f.isDirty){b||f.setPersistent();var h=this._send(d(f)).then(function(c){return b?(f.setDatabaseObject(c.response.entity),f.setPersistent()):f.setDatabaseObjectInfo(c.response.entity._objectInfo),a}.bind(this),function(b){if(b.statusCode==m.OBJECT_NOT_FOUND)return this.removeReference(a),f.setRemoved(),null;throw f.setDirty(),b}.bind(this));g.unshift(h)}else g.unshift(Promise.resolve(a));return Promise.all(g).then(function(){return a})}.bind(this))},getSubEntities:function(a,b,c,d){if(c=c||[],!b)return c;d=d||a;for(var f=e.Metadata.get(a),g=f.type.references(),h=g.next();!h.done;h=g.next())this.getSubEntitiesByPath(a,h.value.path).forEach(function(a){~c.indexOf(a)||a==d||(c.push(a),c=this.getSubEntities(a,b===!0?b:b-1,c,d))}.bind(this));return c},getSubEntitiesByPath:function(a,b){var c=[a];return b.forEach(function(a){var b=[];c.forEach(function(c){var d=c[a];if(d){var e=this.metamodel.managedType(c.constructor).getAttribute(a);if(e.isCollection)for(var f=d.items(),g=f.next();!g.done;g=f.next())b.push(g.value),e.keyType&&e.keyType.isEntity&&b.push(g.index);else b.push(d)}}.bind(this)),c=b}.bind(this)),c},remove:function(a,b,c){return this.attach(a),a.withLock(function(){var d=e.Metadata.get(a),h=[];if(this.getSubEntities(a,c).forEach(function(a){h.push(this.remove(a,b))}.bind(this)),!d.version&&!b)throw new g.IllegalEntityError(a);var i=new f.DeleteObject(d.bucket,d.id,d.getDatabaseObjectInfo(b));b||i.setIfMatch(d.version);var j=this._send(i).then(function(){return this.removeReference(a),d.setRemoved(),a}.bind(this));return h.unshift(j),Promise.all(h).then(function(){return a})}.bind(this))},flush:function(){},persist:function(a){a.attach(this)},refresh:function(a){return this.yield().then(function(){if(this.contains(a)){var b=e.Metadata.get(a);if(b.isNew)throw new g.IllegalEntityError(a);var c=0,d=b.type.id.getValue(a);this.transaction.isChanged(d)&&(c=this.transaction.tid),b.isDirty=!1;var h=this.send(new f.GetObject(b,c)).then(function(){if(b.isDeleted)throw this.removeReference(a),new g.EntityNotFoundError(d)});return this.wait(h)}throw new g.IllegalEntityError(a)})},attach:function(a){if(!this.contains(a)){var b=this.metamodel.entity(classOf(a));if(!b)throw new g.IllegalEntityError(a);if(this.containsById(a))throw new g.EntityExistsError(a);this._attach(a)}},_attach:function(a){var b=e.Metadata.get(a);if(b.isAttached){if(b.db!=this)throw new g.EntityExistsError(a)}else b.db=this;b.id||"_native.User"!=b.type.name&&"_native.Role"!=b.type.name&&(b.id=d.v4()),b.id&&(this._entities[b.ref]=a)},removeReference:function(a){var b=e.Metadata.get(a);if(!b)throw new g.IllegalEntityError(a);delete this._entities[b.ref]},register:function(a,b){if(this.me)throw new Error("User is already logged in.");var c=new f.Register({loginId:a,password:b,global:this.isGlobal});return this._userRequest(c)},login:function(a,b){if(this.me)throw new Error("User is already logged in.");var c=new f.Login({loginId:a,password:b,global:this.isGlobal});return this._userRequest(c)},logout:function(){return this.withLock(function(){var a=function(){this.me=null,this.token=null}.bind(this);return this.isGlobal?this._send(new f.Logout).then(a):Promise.resolve(a())}.bind(this))},renew:function(){var a=new f.RenewToken;return a.withAuthorizationToken(this.isGlobal||this.token),this._userRequest(a)},_userRequest:function(a){return this.withLock(function(){return this._send(a).then(function(){var b=a.getAuthorizationToken();b&&(this.token=b);var c=a.response.entity._objectInfo.id,d=this.getReference("_native.User",c),f=e.Metadata.get(d);return f.setDatabaseObject(a.response.entity),f.setPersistent(),this.me=d}.bind(this))}.bind(this))},validate:function(a){for(var b=e.Metadata.get(a).type,c=b.validationCode,d=[],f=new l,g=b.attributes(),h=g.next();!h.done;h=g.next()){var i=new k(h.value.name,a);d.push(i),f.fields[i.key]=i}return c&&c.apply({},d),f}})},{"./EntityTransaction":4,"./Query":6,"./TypedQuery":7,"./connector/Message":21,"./error":31,"./message":33,"./util":55,"node-uuid":76}],3:[function(a,b,c){var d,e=(a("./message"),a("./metamodel").Metamodel),f=a("./metamodel").Code,g=a("./connector").Connector,h=a("./EntityManager").EntityManager;c.EntityManagerFactory=d=Object.inherit(Bind,{_connector:null,metamodel:null,code:null,initialize:function(a,b,c){Number.isInstance(b)||(c=b,b=null),this._connector=g.create(a,b),this.metamodel=this.createMetamodel(),this.code=this.createCode(),c&&this.metamodel.init(c)},createMetamodel:function(){return new e(this._connector)},createCode:function(){return new f(this._connector)},createEntityManager:function(a,b){return this.metamodel.ready().then(function(){return new h(this)}.bind(this)).then(a,b)}})},{"./EntityManager":2,"./connector":24,"./message":33,"./metamodel":49}],4:[function(a,b,c){var d=a("./message"),e=a("./error");c.EntityTransaction=EntityTransaction=Object.inherit({get isActive(){return Boolean(this.tid)},initialize:function(a){this._connector=a._connector,this.entityManager=a,this.tid=null,this.rollbackOnly=!1,this.readSet=null,this.changeSet=null},begin:function(a,b){return this.yield().then(function(){var a=this.send(new d.PostTransaction).done(function(a){this.tid=a.tid,this.rollbackOnly=!1,this.readSet={},this.changeSet={}});return this.wait(a)}).then(a,b)},commit:function(a,b){return this.yield().then(function(){return this.getRollbackOnly()?this.rollback().then(function(){throw new e.RollbackError}):this.wait(this.entityManager.flush()).then(function(){var a=[];for(var b in this.readSet)a.push({oid:b,version:this.readSet[b]});var c=this.send(new d.PutTransactionCommitted(this.tid,a));return this.wait(c).then(function(a){this.tid=null,this.readSet=null,this.changeSet=null;var b=a.oids;for(var c in b){var d=b[c],e=this.entityManager.entities[c];if(e){var f=util.Metadata.get(e);"DELETED"==d||f.isDeleted?this.entityManager.removeReference(e):f.setDatabaseValue(f.type.version,d)}}})})}).then(a,b)},getRollbackOnly:function(){return this.rollbackOnly},rollback:function(a,b){return this.yield().then(function(){var a=this.send(new d.PutTransactionAborted(this.tid));this.wait(a).then(function(){return this.tid=null,this.readSet=null,this.changeSet=null,this.entityManager.clear()},function(){return this.entityManager.clear()})}).then(a,b)},setRollbackOnly:function(){return this.yield().done(function(){this.rollbackOnly=!0})},isRead:function(a){return this.isActive&&a in this.readSet},setRead:function(a,b){this.isActive&&!this.isChanged(a)&&(this.readSet[a]=b)},isChanged:function(a){return this.isActive&&a in this.changeSet},setChanged:function(a){this.isActive&&(delete this.readSet[a],this.changeSet[a]=!0)}})},{"./error":31,"./message":33}],5:[function(a,b,c){{var d;a("./collection")}c.GeoPoint=d=Object.inherit({extend:{DEG_TO_RAD:Math.PI/180,EARTH_RADIUS_IN_KILOMETERS:6371,EARTH_RADIUS_IN_MILES:3956,current:function(){return new Promise(function(a,b){navigator.geolocation.getCurrentPosition(function(b){a(new d(b.coords.latitude,b.coords.longitude))},function(a){b(a)})})},conv:function(a){return new this(a)}},latitude:0,longitude:0,initialize:function(a,b){if(String.isInstance(a)){var c=a.indexOf(";");this.latitude=a.substring(0,c),this.longitude=a.substring(c+1)}else Number.isInstance(a)?(this.latitude=a,this.longitude=b):Array.isInstance(a)?(this.latitude=a[0],this.longitude=a[1]):Object.isInstance(a)&&(this.latitude=a.latitude,this.longitude=a.longitude);if(this.latitude<-90||this.latitude>90)throw new Error("Latitude "+this.latitude+" is not in bound of -90 <= latitude <= 90");if(this.longitude<-180||this.longitude>180)throw new Error("Longitude "+this.longitude+" is not in bound of -180 <= longitude <= 180")},kilometersTo:function(a){return Number((d.EARTH_RADIUS_IN_KILOMETERS*this.radiansTo(a)).toFixed(3))},milesTo:function(a){return Number((d.EARTH_RADIUS_IN_MILES*this.radiansTo(a)).toFixed(3))},radiansTo:function(a){var b=this,c=a,e=b.latitude*d.DEG_TO_RAD,f=c.latitude*d.DEG_TO_RAD,g=(c.longitude-b.longitude)*d.DEG_TO_RAD;return Math.acos(Math.sin(e)*Math.sin(f)+Math.cos(e)*Math.cos(f)*Math.cos(g))},toString:function(){return this.latitude+";"+this.longitude},toJSON:function(){return{latitude:this.latitude,longitude:this.longitude}}})},{"./collection":18}],6:[function(a,b,c){var d=a("./message");c.Query=Query=Object.inherit({firstResult:0,maxResults:Number.MAX_VALUE,resultClass:null,initialize:function(a,b){this.connector=a.connector,this.entityManager=a,this.qlString=b},getResultList:function(a,b){return this.yield().then(function(){var a,b=this.resultClass?this.entityManager.metamodel.entity(this.resultClass):null;if(this.qlString){if(!b)throw new PositionError("Only typed queries can be executed.");var c=this.qlString;String.isInstance(c)||(c=JSON.stringify(c)),a=new d.GetBucketQuery(b,c,this.firstResult,this.maxResults)}else a=new d.GetAllOids(b,this.firstResult,this.maxResults);return this.send(a).then(function(){return this.createResultList(a.oids)})}.bind(this)).then(a,b)},getSingleResult:function(a,b){var c,e=this.resultClass?this.entityManager.metamodel.entity(this.resultClass):null;if(!this.qlString){var f=new d.GetAllOids(e,this.firstResult,1);c=this.send(f).then(function(a){return this.createResultList(a.oids)}).then(function(a){return a.length?a[0]:null})}c.then(a,b)},createResultList:function(a){var b=new Array(a.length);if(a.length){var c=[];return a.forEach(function(a,d){var e=this.entityManager.find(a.oid||a).then(function(a){b[d]=a});c.push(e)},this),Promise.all(c).then(function(){return b})}return b}})},{"./message":33}],7:[function(a,b,c){var d=a("./Query").Query;c.TypedQuery=TypedQuery=d.inherit({initialize:function(a,b,c){this.superCall(a,b),this.resultClass=c}})},{"./Query":6}],8:[function(a,b,c){c.Accessor=Accessor=Object.inherit({getValue:function(a,b){return a[b.name]},setValue:function(a,b,c){a[b.name]=c}})},{}],9:[function(a,b,c){{var d,e=a("../util").Metadata,f=a("./Entity").Entity,g=a("./Managed").Managed,h=a("./User").User,i=a("./Role").Role;a("../error")}c.Enhancer=d=Object.inherit({createProxyClass:function(a){if(a.isEntity)return a.superType.typeConstructor.inherit({});if(a.isEmbeddable)return Object.inherit({});throw new TypeError("No proxy class can be initialized.")},getIdentifier:function(a){return a.__baqendId__},setIdentifier:function(a,b){a.__baqendId__=b},create:function(a){return Object.create(a.typeConstructor.prototype)},enhance:function(a,b){this.setIdentifier(b,a.ref),this.enhancePrototype(b,a)},enhancePrototype:function(a,b){if(this.mixinType(a,g),b.isEntity&&(this.mixinType(a,f),b.isNative))switch(b.name){case"_native.Role":this.mixinType(a,i);break;case"_native.User":this.mixinType(a,h)}a.prototype.toString===Object.prototype.toString&&(a.prototype.toString=function(){return this._metadata.ref||b.ref});for(var c,d=0;c=b.declaredAttributes[d];++d)this.enhanceProperty(b,c,a)},mixinType:function(a,b){var c=a.linearizedTypes;c&&-1!=c.indexOf(a)||(c=a.linearizedTypes=[Object,a]);var d=a.prototypeChain;d||(d=a.prototypeChain=[a.prototype]),-1==c.indexOf(b)&&(Object.cloneOwnProperties(a.prototype,b.prototype),c.push(b),d.push(b.prototype),a.prototype.constructor=a)},enhanceProperty:function(a,b,c){var d="$"+b.name;Object.defineProperty(c.prototype,b.name,{get:function(){return e.readAccess(this),this._metadata[d]},set:function(a){e.writeAccess(this),this._metadata[d]=a},configurable:!0,enumerable:!0})}})},{"../error":31,"../util":55,"./Entity":10,"./Managed":12,"./Role":14,"./User":15}],10:[function(a,b,c){var d,e=a("./Managed").Managed;c.Entity=d=e.inherit({_readyPromise:Promise.resolve(null),get id(){return this._metadata.id},set id(a){if(this._metadata.id)throw new Error("Id can't be set twice.");this._metadata.id=a},get acl(){return this._metadata.acl},attach:function(a){a.attach(this)},ready:function(a){var b=this;return this._readyPromise.then(function(){return b},function(){return b}).then(a)},withLock:function(a){if(this._isLocked)throw new Error("Current operation has not been finished.");return this._isLocked=!0,this._readyPromise=a().then(function(a){return this._isLocked=!1,a}.bind(this),function(a){throw this._isLocked=!1,a}.bind(this))},save:function(a,b,c,d){return Function.isInstance(a)?(d=b,c=a,b=0,a=!1):Function.isInstance(b)&&(d=c,c=b,b=0),this._metadata.db.save(this,!1,a,b).then(c,d)},saveAndRefresh:function(a,b,c,d){return Function.isInstance(a)?(d=b,c=a,b=0,a=!1):Function.isInstance(b)&&(d=c,c=b,b=0),this._metadata.db.save(this,!0,a,b).then(c,d)},insert:function(a,b,c){return Function.isInstance(a)&&(c=b,b=a,a=0),this._metadata.db.insert(this,!1,a).then(b,c)},insertAndRefresh:function(a,b,c){return Function.isInstance(a)&&(c=b,b=a,a=0),this._metadata.db.insert(this,!0,a).then(b,c)},update:function(a,b,c,d){return Function.isInstance(a)?(d=b,c=a,b=0,a=!1):Function.isInstance(b)&&(d=c,c=b,b=0),this._metadata.db.update(this,!1,a,b).then(c,d)},updateAndRefresh:function(a,b,c,d){return Function.isInstance(a)?(d=b,c=a,b=0,a=!1):Function.isInstance(b)&&(d=c,c=b,b=0),this._metadata.db.update(this,!0,a,b).then(c,d)},refresh:function(a,b,c){return Function.isInstance(a)&&(c=b,b=a,a=0),this._metadata.db.find(this.constructor,this._metadata.id,!0,a).then(b,c)},remove:function(a,b,c,d){return Function.isInstance(a)?(d=b,c=a,b=0,a=!1):Function.isInstance(b)&&(d=c,c=b,b=0),this._metadata.db.remove(this,a,b).then(c,d)},attr:function(){throw new Error("Attr is not yet implemented.")},validate:function(){return this._metadata.db.validate(this)},toJSON:function(a){return this._metadata.getDatabaseObject(!a,!a)}})},{"./Managed":12}],11:[function(a,b,c){var d,e=a("./ManagedFactory").ManagedFactory,f=a("../util/Metadata").Metadata;c.EntityFactory=d=e.inherit({extend:{create:function(a,b){var c=e.create(a,b);return Object.cloneOwnProperties(c,d.prototype),c}},newInstance:function(a){var b=this._managedType.create();return f.get(b).db=this._db,this._managedType.typeConstructor.apply(b,a),b},get:function(a,b,c,d){return Function.isInstance(b)&&(d=c,c=b,b=0),this._db.find(this._managedType.typeConstructor,a,!1,b).then(c,d)},_getHandler:function(a){var b=this._db.code.getHandler(this._managedType.name,a);return b?function(a){return b.call(a,this._db)}.bind(this):null},get onInsert(){return this._getHandler("insert")},get onDelete(){return this._getHandler("delete")},get onUpdate(){return this._getHandler("update")},get onValidate(){return this._managedType.validationCode},fromJSON:function(a){var b=a._objectInfo?this._db.getReference(this._managedType.typeConstructor,a._objectInfo.id):this.newInstance(),c=f.get(b);return c.setDatabaseObject(a),c.setDirty(),b},find:function(){throw new Error("find is not yet implemented.")},partialUpdate:function(){throw new Error("partialUpdate is not yet implemented.")}})},{"../util/Metadata":52,"./ManagedFactory":13}],12:[function(a,b,c){var d,e=a("../util/Metadata").Metadata;c.Managed=d=Trait.inherit({get _metadata(){return Object.defineProperty(this,"_metadata",{value:new e(this),configurable:!0}),this._metadata}})},{"../util/Metadata":52}],13:[function(a,b,c){var d;c.ManagedFactory=d=Object.inherit({extend:{create:function(a,b){var c=function(){return c.newInstance(arguments)};return Object.cloneOwnProperties(c,d.prototype),c.initialize(a,b),c}},methods:null,_managedType:null,_db:null,initialize:function(a,b){this.methods=a.typeConstructor.prototype,this._managedType=a,this._db=b},newInstance:function(a){var b=this._managedType.create();return this._managedType.typeConstructor.apply(b,a),b},addMethods:function(a){Object.extend(this.methods,a)},addMethod:function(a,b){this.methods[a]=b}})},{}],14:[function(a,b,c){var d,e=a("./Entity").Entity,f=a("./User").User,g=a("../collection").Set;c.Role=d=e.inherit({get users(){return this.users=new g},set users(a){Object.defineProperty(this,"users",{value:a,writable:!0,configurable:!0,enumerable:!0})},name:null,initialize:function(){this.users=new g},hasUser:function(a){return this.users.has(a)},addUser:function(a){if(!f.isInstance(a))throw new Error("Only user instances can be added to a role.");this.users.add(a)},removeUser:function(a){if(!f.isInstance(a))throw new Error("Only user instances can be removed from a role.");this.users.remove(a)}})},{"../collection":18,"./Entity":10,"./User":15}],15:[function(a,b,c){var d,e=a("./Entity").Entity;c.User=d=e.inherit({username:null,email:null})},{"./Entity":10}],16:[function(a,b,c){var d,e=a("./EntityFactory").EntityFactory;c.UserFactory=d=e.inherit({extend:{create:function(a,b){var c=e.create(a,b);return Object.cloneOwnProperties(c,d.prototype),c}},register:function(a,b,c,d){return this._db.register(a,b).then(c,d)},login:function(a,b,c,d){return this._db.login(a,b).then(c,d)},logout:function(a,b){return this._db.logout().then(a,b)},get me(){return this._db.me}})},{"./EntityFactory":11}],17:[function(a,b,c){c.Accessor=a("./Accessor").Accessor,c.Enhancer=a("./Enhancer").Enhancer,c.ManagedFactory=a("./ManagedFactory").ManagedFactory,c.EntityFactory=a("./EntityFactory").EntityFactory,c.UserFactory=a("./UserFactory").UserFactory,c.Managed=a("./Managed").Managed,c.Entity=a("./Entity").Entity,c.Role=a("./Role").Role,c.User=a("./User").User},{"./Accessor":8,"./Enhancer":9,"./Entity":10,"./EntityFactory":11,"./Managed":12,"./ManagedFactory":13,"./Role":14,"./User":15,"./UserFactory":16}],18:[function(a,b,c){var d,e,f,g,h,i,j,k,l=a("./util/Metadata").Metadata;c.Iterator=d=Trait.inherit({extend:{conv:function(a){return a?a.iterator&&Function.isInstance(a.iterator)?a.iterator():Array.isInstance(a)?new e(a.length,function(b){return[b,a[b]]}):new f(a):void 0},DONE:{done:!0}},iterator:function(){return this},next:function(){return d.DONE}}),c.IndexIterator=e=Object.inherit(d,{length:0,index:0,accessor:null,initialize:function(a,b){this.length=a,b&&(this.accessor=b)},next:function(){if(this.index<this.length){var a={done:!1,index:this.index,value:this.accessor(this.index)};return this.index++,a}return d.DONE}}),c.PropertyIterator=f=d.inherit({names:null,object:null,index:0,initialize:function(a){this.object=a,this.names=Object.getOwnPropertyNames(a)},next:function(){if(this.names.length<this.index){var a=this.names[this.index++];return{done:!1,index:a,value:this.object[a]}}return d.DONE}}),c.Iterable=g=Trait.inherit({forEach:function(a,b){if(!a||!Function.isInstance(a))throw new TypeError(a+" is not a function");for(var c=d(this),e=c.next();!e.done;e=c.next())a.call(b,e.value,e.index,this)},every:function(a,b){if(!a||!Function.isInstance(a))throw new TypeError(a+" is not a function");for(var c=d(this),e=c.next();!e.done;e=c.next())if(!a.call(b,e.value,e.index,this))return!1;return!0},some:function(a,b){if(!Function.isInstance(a))throw new TypeError(a+" is not a function");for(var c=d(this),e=c.next();!e.done;e=c.next())if(a.call(b,e.value,e.index,this))return!0;return!1},filter:function(a,b){if(!Function.isInstance(a))throw new TypeError(a+" is not a function");for(var c=new this.constructor,e=d(this),f=e.next();!f.done;f=e.next())a.call(b,f.value,f.index,this)&&(c.set?c.set(f.index,f.value):c.add(f.value));return c},map:function(a,b){if(!Function.isInstance(a))throw new TypeError(a+" is not a function");for(var c=new this.constructor,e=d(this),f=e.next();!f.done;f=e.next())f=a.call(b,f.value,f.index,this),c.set?c.set(f.index,f.value):c.add(f.value);return c},reduce:function(a,b){if(!Function.isInstance(a))throw new TypeError(a+" is not a function");var c=d(this);1==arguments.length&&(b=c.next().value);for(var e;!(e=c.next()).done;)b=a.call(null,b,e.value,e.index,this);return b}}),c.Collection=h=Object.inherit(g,{extend:{conv:function(a){if(a){if(Array.isInstance(a)){for(var b=new this,c=0,d=a.length;d>c;++c)b.add(a[c]);return b}if(h.isInstance(a))return new this(a)}return null}},size:0,seq:[],initialize:function(a){if(this.seq=[],this.size=0,a)for(var b=a.iterator(),c=b.next();!c.done;c=b.next())this.add(c.value)},has:function(a){return l.readAccess(this),-1!=this.seq.indexOf(a)},add:function(a){l.writeAccess(this),this.seq[this.size++]=a},remove:function(a){l.writeAccess(this);var b=this.seq.indexOf(a);b>-1&&(this.seq.splice(b,1),this.size--)},items:function(){l.readAccess(this);var a=this.seq;return new e(this.size,function(b){return a[b]})},iterator:function(){return l.readAccess(this),this.items()},toString:function(){return l.readAccess(this),this.seq.toString()},toJSON:function(){return l.readAccess(this),this.seq}}),c.List=i=h.inherit({extend:{conv:h.conv},get:function(a){return l.readAccess(this),0>a&&(a=this.size+a),a>=0&&a<this.size?this.seq[a]:void 0},set:function(a,b){l.writeAccess(this),0>a&&(a=this.size+a),0>a?(this.seq.unshift(b),this.size++):a>=this.size?(this.seq.push(b),this.size++):this.seq[a]=b},indexOf:function(a){return l.readAccess(this),this.seq.indexOf(a)},lastIndexOf:function(a){return l.readAccess(this),this.seq.lastIndexOf(a)}}),c.Set=j=h.inherit({extend:{conv:h.conv},add:function(a){l.readAccess(this);var b=this.seq.indexOf(a);0>b&&(this.seq[this.size++]=a)}}),c.Map=k=h.inherit({extend:{Iterator:Object.inherit(d,{index:0,map:null,initialize:function(a){this.map=a},next:function(){if(this.index<this.map.size){var a=this.index++;return{done:!1,index:this.map.seq[a],value:this.map.vals[a]}}return d.DONE}}),conv:function(a){if(a)if(Array.isInstance(a)){for(var b,c=new this,d=0;(b=a[d])&&("key"in b&&"value"in b);++d)c.set(b.key,b.value);if(c.size==a.length)return c}else if(h.isInstance(a))return new this(a);return null}},initialize:function(a){if(this.vals=[],h.isInstance(a))for(var b=a.items(),c=b.next();!c.done;c=b.next())this.set(c.index,c.value)},get:function(a){l.readAccess(this);var b=this.seq.indexOf(a);return b>-1?this.vals[b]:void 0},add:function(a){l.writeAccess(this),this.set(a)},set:function(a,b){l.writeAccess(this);var c=this.seq.indexOf(a);-1==c&&(c=this.seq.length,this.seq[c]=a,this.size++),this.vals[c]=b},remove:function(a){l.writeAccess(this);var b=this.seq.indexOf(a);b>-1&&(this.seq.splice(b,1),this.vals.splice(b,1),this.size--)},items:function(){return l.readAccess(this),new k.Iterator(this)},keys:function(){return l.readAccess(this),this.iterator()},values:function(){l.readAccess(this);var a=this;return new e(this.size,function(b){return a.seq[b]})},toString:function(){l.readAccess(this);for(var a="",b=0,c=this.size;c>b;++b)""!=a&&(a+=", "),a+=this.seq[b],a+=": ",a+=this.vals[b];return"["+a+"]"},toJSON:function(){l.readAccess(this);for(var a=[],b=0,c=this.size;c>b;++b)a.push({key:this.seq[b],value:this.vals[b]});return a}})},{"./util/Metadata":52}],19:[function(a,b,c){var d,e=a("../error/PersistentError").PersistentError;c.Connector=d=Object.inherit({extend:{RESPONSE_HEADERS:["Orestes-Authorization-Token"],connectors:[],connections:{},create:function(a,b,c){if(a||"undefined"==typeof window||(a=window.location.hostname,b=Number(window.location.port)),-1!=a.indexOf("/")){var d=/^(https?):\/\/([^\/:]*)(:(\d*))?\/?$/.exec(a);if(!d)throw new Error("The connection uri host "+a+" seems not to be valid");c="https"==d[1],a=d[2],b=d[4]}b||(b=c?443:80);var e="http"+(c?"s":"")+"://"+a+":"+b,f=this.connections[e];if(!f){for(var g in this.connectors){var h=this.connectors[g];if(h.isUsable&&h.isUsable(a,b,c)){f=new h(a,b,c);break}}if(!f)throw new Error("No connector is usable for the requested connection.");this.connections[e]=f}return f}},initialize:function(a,b,c){this.host=a,this.port=b,this.secure=c},send:function(a){return new Promise(function(b,c){this.prepareRequestEntity(a),this.doSend(a.request,this.receive.bind(this,a,b,c))}.bind(this)).catch(function(a){throw e(a)})},receive:function(a,b,c,d){a.response=d;try{this.prepareResponseEntity(a),a.doReceive(),b(a)}catch(f){f=e(f),a.response.entity=null,c(f)}},doSend:function(){},prepareRequestEntity:function(a){a.request.entity&&(a.request.headers["Content-Type"]="application/json;charset=utf-8",a.request.entity=JSON.stringify(a.request.entity))},prepareResponseEntity:function(a){var b=a.response.entity;b=b&&b.length>0?JSON.parse(b):null,a.response.entity=b}})},{"../error/PersistentError":29}],20:[function(a,b,c){var d,e=a("./Connector").Connector;c.IFrameConnector=d=e.inherit({extend:{loadedAttr:"data-loaded",style:"width:1px;height:1px;position:absolute;top:-10px;left:-10px;",initialize:function(){e.connectors.push(this)},isUsable:function(a,b){return"undefined"!=typeof window&&(window.location.hostname!=a||window.location.port!=b)}},queue:null,origin:null,iframe:null,messages:null,mid:0,initialize:function(a,b,c){this.origin=(c?"https://":"http://")+a,this.origin=80==b||443==b?this.origin:this.origin+":"+b,this.messages={};var e=this.origin+"/connect";this.iframe=document.querySelector('iframe[src="'+e+'"]'),this.iframe&&this.iframe.src==e||(this.iframe=document.createElement("iframe"),this.iframe.src=e,this.iframe.setAttribute("style",d.style),document.body.appendChild(this.iframe)),this.isLoaded()||(this.queue=[],this.iframe.addEventListener("load",this.onLoad.bind(this),!1)),window.addEventListener("message",this.doReceive.bind(this),!1)},onLoad:function(){for(var a=this.queue,b=0;b<a.length;++b)this.iframe.contentWindow.postMessage(a[b],this.origin);this.queue=null,this.setLoaded()},setLoaded:function(){this.iframe.setAttribute(d.loadedAttr,!0)},isLoaded:function(){return!!this.iframe.getAttribute(d.loadedAttr)},doSend:function(a,b){var c={mid:++this.mid,method:a.method,path:a.path,headers:a.headers,entity:a.entity,responseHeaders:e.RESPONSE_HEADERS};this.messages[c.mid]={request:a,receive:b},c=JSON.stringify(c),this.queue?this.queue.push(c):this.iframe.contentWindow.postMessage(c,this.origin)},doReceive:function(a){if(a.origin===this.origin&&"{"==a.data[0]){var b=JSON.parse(a.data),c=this.messages[b.mid];delete this.messages[b.mid],c.receive({statusCode:b.statusCode,headers:b.headers,entity:b.entity})}}})},{"./Connector":19}],21:[function(a,b,c){var d,e=a("../error/CommunicationError").CommunicationError;c.Message=d=Object.inherit({extend:{StatusCode:{NOT_MODIFIED:304,BAD_CREDENTIALS:460,BUCKET_NOT_FOUND:461,INVALID_PERMISSION_MODIFICATION:462,INVALID_TYPE_VALUE:463,OBJECT_NOT_FOUND:404,OBJECT_OUT_OF_DATE:412,PERMISSION_DENIED:466,QUERY_DISPOSED:467,QUERY_NOT_SUPPORTED:468,SCHEMA_NOT_COMPATIBLE:469,SCHEMA_STILL_EXISTS:470,SYNTAX_ERROR:471,TRANSACTION_INACTIVE:472,TYPE_ALREADY_EXISTS:473,TYPE_STILL_REFERENCED:474},create:function(a){return d.inherit({spec:a})
}},spec:null,withCredentials:!1,initialize:function(){var a=arguments,b=0;this.request={method:this.spec.method,path:this.spec.params.map(function(c){return Number.isInstance(c)?(b++,encodeURIComponent(a[c])):c}).join(""),headers:{accept:"application/json"},entity:a[b]||null},this.response={statusCode:0,headers:{},entity:null}},setIfMatch:function(a){"*"!=a&&(a='"'+a+'"'),this.request.headers["If-Match"]=a},setIfNoneMatch:function(a){"*"!=a&&(a='"'+a+'"'),this.request.headers["If-None-Match"]=a},setCacheControl:function(a){this.request.headers["Cache-Control"]=a},getAuthorizationToken:function(){return this.response.headers["Orestes-Authorization-Token"]||this.response.headers["orestes-authorization-token"]},setAuthorizationToken:function(a){this.request.headers.Authorization="BAT "+a},withAuthorizationToken:function(a){a===!0?this.request.withCredentials=!0:a&&this.setAuthorizationToken(a)},doReceive:function(){if(-1==this.spec.status.indexOf(this.response.statusCode))throw new e(this)}})},{"../error/CommunicationError":25}],22:[function(a,b,c){var d=a("./Connector").Connector;c.NodeConnector=NodeConnector=d.inherit({extend:{initialize:function(){d.connectors.push(this)},isUsable:function(b,c,d){if(!this.prototype.http)try{var e;e=a(d?"https":"http"),e.request&&(this.prototype.http=e)}catch(f){}return Boolean(this.prototype.http)}},cookie:null,doSend:function(a,b){a.host=this.host,a.port=this.port;var c=this,d=a.entity;d&&(a.headers["Transfer-Encoding"]="chunked"),this.cookie&&this.secure&&a.withCredentials&&(a.headers.Cookie=this.cookie);var e=this.http.request(a,function(a){var d="";a.setEncoding("utf-8"),a.on("data",function(a){d+=a}),a.on("end",function(){var e=a.headers["set-cookie"];e&&(c.cookie=c.parseCookie(e+"")),b({statusCode:a.statusCode,headers:a.headers,entity:d})})});e.on("error",function(a){b({statusCode:0,error:a})}),d&&e.write(d,"utf8"),e.end()},parseCookie:function(a){for(var b,c=a.split(";"),d=0;b=c[d];++d)if(0==b.indexOf("Expires=")){var e=Date.parse(b.substring(8));if(e<Date.now())return null}return c[0]}})},{"./Connector":19,http:void 0,https:void 0}],23:[function(a,b,c){var d=a("./Connector").Connector;c.XMLHttpConnector=XMLHttpConnector=d.inherit({extend:{initialize:function(){d.connectors.push(this)},isUsable:function(a,b){return"undefined"!=typeof window&&window.location.hostname==a&&window.location.port==b?"undefined"!=typeof XMLHttpRequest:!1}},doSend:function(a,b){var c=new XMLHttpRequest,e=(this.secure?"https":"http")+"://"+this.host+":"+this.port+a.path;c.onreadystatechange=function(){if(4==c.readyState){var a={headers:{},statusCode:c.status,entity:c.response||c.responseText};d.RESPONSE_HEADERS.forEach(function(b){a.headers[b]=c.getResponseHeader(b)}),b(a)}},c.open(a.method,e,!0);var f=a.entity,g=a.headers;for(var h in g)c.setRequestHeader(h,g[h]);c.withCredentials=a.withCredentials,c.send(f)}})},{"./Connector":19}],24:[function(a,b,c){c.Message=a("./Message").Message,c.Connector=a("./Connector").Connector,c.NodeConnector=a("./NodeConnector").NodeConnector,c.XMLHttpConnector=a("./XMLHttpConnector").XMLHttpConnector,c.IFrameConnector=a("./IFrameConnector").IFrameConnector},{"./Connector":19,"./IFrameConnector":20,"./Message":21,"./NodeConnector":22,"./XMLHttpConnector":23}],25:[function(a,b,c){var d=a("./PersistentError").PersistentError;c.CommunicationError=d.inherit({statusCode:0,initialize:function(a){var b=0==a.response.statusCode?"Request":"Response";this.superCall("baqend.error.CommunicationError: Communication failed by handling the "+b+" for "+a.request.method+" "+a.request.path),this.statusCode=a.response.statusCode;var c=a.response.entity;for(c.data&&(this.data=c.data);c;){this.stack+="\nServerside Caused by: "+c.className+" "+c.message;for(var d=c.stackTrace,e=0;e<d.length;++e){var f=d[e];this.stack+="\n    at "+f.className+"."+f.methodName,this.stack+=" ("+f.fileName+":"+f.lineNumber+")"}c=c.cause}}})},{"./PersistentError":29}],26:[function(a,b,c){var d=a("./PersistentError").PersistentError;c.EntityExistsError=EntityExistsError=d.inherit({initialize:function(a){this.superCall("baqend.error.EntityExistsError: The entity "+a+" is managed by a different db."),this.entity=a}})},{"./PersistentError":29}],27:[function(a,b,c){var d=a("./PersistentError").PersistentError;c.EntityNotFoundError=EntityNotFoundError=d.inherit({initialize:function(a){this.superCall("baqend.error.EntityNotFoundError: Entity "+a+" is not found"),this.identity=a}})},{"./PersistentError":29}],28:[function(a,b,c){var d=a("./PersistentError").PersistentError;c.IllegalEntityError=IllegalEntityError=d.inherit({initialize:function(a){this.superCall("baqend.error.IllegalEntityError: Entity "+a+" is not a valid entity"),this.entity=a}})},{"./PersistentError":29}],29:[function(a,b,c){c.PersistentError=PersistentError=Error.inherit({cause:null,extend:{conv:function(a){return Error.isInstance(a)?new this(null,a):void 0}},initialize:function(a,b){this.superCall(a?a:b.message),b&&(this.cause=b,this.stack+="\nCaused By: "+b.stack)}})},{}],30:[function(a,b,c){var d=a("./PersistentError").PersistentError;c.RollbackError=RollbackError=d.inherit({initialize:function(a){this.superCall("baqend.error.RollbackError: The transaction has been rollbacked",a)}})},{"./PersistentError":29}],31:[function(a,b,c){c.CommunicationError=a("./CommunicationError").CommunicationError,c.EntityExistsError=a("./EntityExistsError").EntityExistsError,c.EntityNotFoundError=a("./EntityNotFoundError").EntityNotFoundError,c.IllegalEntityError=a("./IllegalEntityError").IllegalEntityError,c.PersistentError=a("./PersistentError").PersistentError,c.RollbackError=a("./RollbackError").RollbackError},{"./CommunicationError":25,"./EntityExistsError":26,"./EntityNotFoundError":27,"./IllegalEntityError":28,"./PersistentError":29,"./RollbackError":30}],32:[function(a,b,c){a("jahcode"),a("./polyfills");var d="undefined"!=typeof window?window:global;d.Promise=d.Promise||a("lie"),a("./DB"),c.Collection=a("./collection").Collection,c.List=a("./collection").List,c.Set=a("./collection").Set,c.Map=a("./collection").Map,c.binding=a("./binding"),c.connector=a("./connector"),c.error=a("./error"),c.message=a("./message"),c.metamodel=a("./metamodel"),c.util=a("./util"),c.EntityManager=a("./EntityManager").EntityManager,c.EntityManagerFactory=a("./EntityManagerFactory").EntityManagerFactory,c.EntityTransaction=a("./EntityTransaction").EntityTransaction,c.Query=a("./Query").Query,c.TypedQuery=a("./TypedQuery").TypedQuery,c.GeoPoint=a("./GeoPoint").GeoPoint},{"./DB":1,"./EntityManager":2,"./EntityManagerFactory":3,"./EntityTransaction":4,"./GeoPoint":5,"./Query":6,"./TypedQuery":7,"./binding":17,"./collection":18,"./connector":24,"./error":31,"./message":33,"./metamodel":49,"./polyfills":50,"./util":55,jahcode:57,lie:61}],33:[function(a,b,c){var d=a("./connector/Message").Message;c.ListAllResources=d.create({method:"GET",params:["/"],status:[200]}),c.ApiVersion=d.create({method:"GET",params:["/version"],status:[200]}),c.ListAllApis=d.create({method:"GET",params:["/spec"],status:[200]}),c.ListApiSpecification=d.create({method:"GET",params:["/spec/",0],status:[200]}),c.ListDbResources=d.create({method:"GET",params:["/db"],status:[200]}),c.GetBucketNames=d.create({method:"GET",params:["/db/all_buckets"],status:[200]}),c.ListBucketSubresurces=d.create({method:"GET",params:["/db/",0],status:[200]}),c.ListReplicationResources=d.create({method:"GET",params:["/replication"],status:[200]}),c.GetBloomFilter=d.create({method:"GET",params:["/replication/bloomfilter"],status:[200]}),c.GetOrestesConfig=d.create({method:"GET",params:["/config"],status:[200]}),c.UpdateOrestesConfig=d.create({method:"PUT",params:["/config"],status:[202,204]}),c.Create=d.create({method:"POST",params:["/create"],status:[201]}),c.Connect=d.create({method:"GET",params:["/connect"],status:[200]}),c.GetBucketOids=d.create({method:"GET",params:["/db/",0,"/all_oids;start=",1,";count=",2],status:[200]}),c.CreateObject=d.create({method:"POST",params:["/db/",0],status:[201,202]}),c.GetObject=d.create({method:"GET",params:["/db/",0,"/",1],status:[200,304]}),c.ReplaceObject=d.create({method:"PUT",params:["/db/",0,"/",1],status:[200,202]}),c.DeleteObject=d.create({method:"DELETE",params:["/db/",0,"/",1],status:[202,204]}),c.GetAllSchemas=d.create({method:"GET",params:["/db/schema"],status:[200]}),c.UpdateAllSchemas=d.create({method:"POST",params:["/db/schema"],status:[200]}),c.ReplaceAllSchemas=d.create({method:"PUT",params:["/db/schema"],status:[200]}),c.DeleteAllSchemas=d.create({method:"DELETE",params:["/db/schema"],status:[204,304]}),c.GetSchema=d.create({method:"GET",params:["/db/schema/",0],status:[200]}),c.UpdateSchema=d.create({method:"POST",params:["/db/schema/",0],status:[200]}),c.ReplaceSchema=d.create({method:"PUT",params:["/db/schema/",0],status:[200]}),c.DeleteSchema=d.create({method:"DELETE",params:["/db/schema/",0],status:[204,304]}),c.QueryByExampel=d.create({method:"GET",params:["/db/",0,"?query=",1,"&start=",2,"&count=",3],status:[200]}),c.Query=d.create({method:"POST",params:["/db/",0,"?start=",1,"&count=",2],status:[200]}),c.ListQueryResources=d.create({method:"GET",params:["/query"],status:[200]}),c.CreateQuery=d.create({method:"POST",params:["/query"],status:[201]}),c.ListThisQueryResources=d.create({method:"GET",params:["/query/",0],status:[200]}),c.GetQueryCode=d.create({method:"GET",params:["/query/",0,"/source"],status:[200]}),c.RunQuery=d.create({method:"GET",params:["/query/",0,"/result;start=",1,";count=",2],status:[200]}),c.GetQueryParameters=d.create({method:"GET",params:["/query/",0,"/parameters"],status:[200]}),c.GetActiveTransactions=d.create({method:"GET",params:["/transaction"],status:[200]}),c.NewTransaction=d.create({method:"POST",params:["/transaction"],status:[201]}),c.ListTransactionalSubresurces=d.create({method:"GET",params:["/transaction/",0],status:[200]}),c.AbortTransaction=d.create({method:"PUT",params:["/transaction/",0,"/aborted"],status:[204]}),c.GetTransactionChangeset=d.create({method:"GET",params:["/transaction/",0,"/changeset"],status:[200]}),c.CommitTransaction=d.create({method:"PUT",params:["/transaction/",0,"/committed"],status:[200]}),c.ListTransactionResources=d.create({method:"GET",params:["/transaction/",0,"/dbview"],status:[200]}),c.ListTransactionBucketResources=d.create({method:"GET",params:["/transaction/",0,"/dbview/",1],status:[200]}),c.GetTransactionStateObject=d.create({method:"GET",params:["/transaction/",0,"/dbview/",1,"/",2],status:[200]}),c.QueryTransactional=d.create({method:"POST",params:["/transaction/",0,"/queryview/adhoc;start=",1,";count=",2],status:[200]}),c.RunQueryTransactional=d.create({method:"GET",params:["/transaction/",0,"/queryview/",1,"/result;start=",2,";count=",3],status:[200]}),c.UpdatePartially=d.create({method:"POST",params:["/db/",0,"/",1],status:[204]}),c.UpdateField=d.create({method:"POST",params:["/db/",0,"/",1,"/",2],status:[204]}),c.Login=d.create({method:"POST",params:["/db/_native.User/login"],status:[200]}),c.Register=d.create({method:"POST",params:["/db/_native.User/register"],status:[200]}),c.RenewToken=d.create({method:"GET",params:["/db/_native.User/renew"],status:[200]}),c.ValidateUser=d.create({method:"GET",params:["/db/_native.User/validate"],status:[200]}),c.Logout=d.create({method:"GET",params:["/db/_native.User/logout"],status:[200]}),c.GetBaqendHandler=d.create({method:"GET",params:["/code/",0,"/",1],status:[200]}),c.SetBaqendHandler=d.create({method:"PUT",params:["/code/",0,"/",1],status:[200]}),c.DeleteBaqendHandler=d.create({method:"DELETE",params:["/code/",0,"/",1],status:[204]}),c.SetBaqendCode=d.create({method:"PUT",params:["/code/",0],status:[200]}),c.GetBaqendCode=d.create({method:"GET",params:["/code/",0],status:[200]}),c.DeleteBaqendCode=d.create({method:"DELETE",params:["/code/",0],status:[204]}),c.CallBaqendCode=d.create({method:"POST",params:["/code/",0],status:[200,204]})},{"./connector/Message":21}],34:[function(a,b,c){var d,e=a("../binding").Accessor;c.Attribute=d=Object.inherit({extend:{PersistentAttributeType:{BASIC:0,ELEMENT_COLLECTION:1,EMBEDDED:2,MANY_TO_MANY:3,MANY_TO_ONE:4,ONE_TO_MANY:5,ONE_TO_ONE:6}},get isAssociation(){return this.persistentAttributeType>d.PersistentAttributeType.EMBEDDED},get isCollection(){return this.persistentAttributeType==d.PersistentAttributeType.ELEMENT_COLLECTION},isId:!1,isVersion:!1,accessor:null,persistentAttributeType:-1,declaringType:null,name:null,initialize:function(a,b){this.accessor=new e,this.declaringType=a,this.name=b},getValue:function(a){return this.isId||this.isVersion?a._metadata[this.name]:this.accessor.getValue(a,this)},setValue:function(a,b){this.isId||this.isVersion?a._metadata[this.name]=b:this.accessor.setValue(a,this,b)},toJSON:function(){}})},{"../binding":17}],35:[function(a,b,c){var d=a("./Type").Type,e=a("../GeoPoint").GeoPoint;c.BasicType=BasicType=d.inherit({persistenceType:d.PersistenceType.BASIC,noResolving:!1,initialize:function(a,b,c){0!=a.indexOf("/db/")&&(a="/db/_native."+a),this.superCall(a,b),this.noResolving=c},toDatabaseValue:function(a,b){return null===b||void 0===b?null:this.typeConstructor.asInstance(b)},fromDatabaseValue:function(a,b){return null===b||void 0===b?null:this.typeConstructor.asInstance(b)},toString:function(){return"BasicType("+this.ref+")"}}),BasicType.extend({Boolean:new BasicType("Boolean",Boolean),Float:new BasicType("Float",Number),Integer:new BasicType("Integer",Number),String:new BasicType("String",String),DateTime:new(BasicType.inherit({initialize:function(){this.superCall("DateTime",Date)},toDatabaseValue:function(a,b){var c=this.superCall(a,b);return c&&(c=c.toISOString()),c}})),Date:new(BasicType.inherit({initialize:function(){this.superCall("Date",Date)},toDatabaseValue:function(a,b){var c=this.superCall(a,b);return c&&(c=c.toISOString(),c=c.substring(0,c.indexOf("T"))),c}})),Time:new(BasicType.inherit({initialize:function(){this.superCall("Time",Date)},toDatabaseValue:function(a,b){var c=this.superCall(a,b);return c&&(c=c.toISOString(),c=c.substring(c.indexOf("T")+1)),c},fromDatabaseValue:function(a,b){return this.superCall(a,b?"1970-01-01T"+b:b)}})),GeoPoint:new BasicType("GeoPoint",e),JsonArray:new(BasicType.inherit({initialize:function(){this.superCall("JsonArray",Array)},init:function(a){this._enhancer=a},toDatabaseValue:function(a,b){return b&&b.constructor==Array?b:null}})),JsonObject:new(BasicType.inherit({initialize:function(){this.superCall("JsonObject",Object)},init:function(a){this._enhancer=a},toDatabaseValue:function(a,b){return b&&b.constructor==Object?b:null}}))})},{"../GeoPoint":5,"./Type":48}],36:[function(a,b,c){var d,e=a("../message");c.Code=d=Object.inherit({_connector:null,_handler:null,_code:null,_isLoaded:!1,initialize:function(a){this._handler={},this._code={},this._connector=a},_toString:function(a){return a?(a=a.toString(),a.slice(a.indexOf("{")+1,a.lastIndexOf("}"))):""},_fromString:function(a){return new Function("db",a)},setHandler:function(a,b,c){this._handler[a]=this._handler[a]||{},this._handler[a][b]=String.isInstance(c)?c:this._toString(c)},getHandler:function(a,b){var c=this._handler[a]||{},d=c[b];return d?this._fromString(d):null},setCode:function(a,b){this._code[a]=String.isInstance(b)?b:this._toString(b)},getCode:function(a){var b=this._code[a];return b?this._fromString(b):null},removeHandler:function(a,b){var c=this._handler[a]||{};delete c[b]},loadInsert:function(a,b){return this._loadHandler(a.name,"insert",b)},saveInsert:function(a,b,c){return this._saveHandler(a.name,"insert",b,c)},deleteInsert:function(a,b){return this._deleteHandler(a.name,"insert",b)},loadUpdate:function(a,b){return this._loadHandler(a.name,"update",b)},saveUpdate:function(a,b,c){return this._saveHandler(a.name,"update",b,c)},deleteUpdate:function(a,b){return this._deleteHandler(a.name,"update",b)},loadDelete:function(a,b){return this._loadHandler(a.name,"delete",b)},saveDelete:function(a,b,c){return this._saveHandler(a.name,"delete",b,c)},deleteDelete:function(a,b){return this._deleteHandler(a.name,"delete",b)},loadValidate:function(a,b){return this._loadHandler(a.name,"validate",b).then(function(){return a.validationCode=this._handler[a.name].validate,a.validationCode}.bind(this))},saveValidate:function(a,b,c){return this._saveHandler(a.name,"validate",b,c).then(function(){return a.validationCode=this._handler[a.name].validate,a.validationCode}.bind(this))},deleteValidate:function(a,b){return this._deleteHandler(a.name,"validate",b).then(function(){a.validationCode=null})},saveCode:function(a,b,c){var d=new e.SetBaqendCode(a,this._toString(b));return d.withAuthorizationToken(c||!0),this._connector.send(d).then(function(b){return this.setCode(a,b.response.entity),this._fromString(b.response.entity)}.bind(this))},loadCode:function(a,b){var c=new e.GetBaqendCode(a);return c.withAuthorizationToken(b||!0),this._connector.send(c).then(function(b){return this.setCode(a,b.response.entity),this._fromString(b.response.entity)}.bind(this))},deleteCode:function(a,b){var c=new e.DeleteBaqendCode(a);return c.withAuthorizationToken(b||!0),this._connector.send(c).then(function(){this.setCode(a,"")}.bind(this))},callCode:function(a,b,c){var d=new e.CallBaqendCode(a,b);return d.withAuthorizationToken(c||!0),this._connector.send(d).then(function(a){return a.response.entity})},_saveHandler:function(a,b,c,d){return this._saveLoadHandler(a,b,c,d)},_loadHandler:function(a,b,c){return this._saveLoadHandler(a,b,null,c)},_saveLoadHandler:function(a,b,c,d){var f=null===c?new e.GetBaqendHandler(a,b):new e.SetBaqendHandler(a,b,this._toString(c));return f.withAuthorizationToken(d||!0),this._connector.send(f).then(function(c){this.setHandler(a,b,c.response.entity)}.bind(this))},_deleteHandler:function(a,b,c){var d=new e.DeleteBaqendHandler(a,b);return d.withAuthorizationToken(c||!0),this._connector.send(d).then(function(){this.removeHandler(a,b)}.bind(this))}})},{"../message":33}],37:[function(a,b,c){var d=a("./PluralAttribute").PluralAttribute,e=a("../collection");c.CollectionAttribute=CollectionAttribute=d.inherit({collectionType:d.CollectionType.COLLECTION,initialize:function(a,b,c){this.superCall(a,b,c),this.typeConstructor=e.Collection}})},{"../collection":18,"./PluralAttribute":45}],38:[function(a,b,c){var d=a("./ManagedType").ManagedType,e=a("./Type").Type,f=a("../binding/ManagedFactory").ManagedFactory;c.EmbeddableType=EmbeddableType=d.inherit({persistenceType:e.PersistenceType.EMBEDDABLE,createObjectFactory:function(a){return f.create(this,a)},toDatabaseValue:function(a,b){return this.typeConstructor.isInstance(b)&&!b.hasOwnProperty("_metadata")&&(b._metadata={_root:a._root}),this.superCall(a,b)},fromDatabaseValue:function(a,b,c){return!c&&b&&(c=this.create(),c._metadata._root=a._root),this.superCall(a,b,c)},toString:function(){return"EmbeddableType("+this.ref+")"}})},{"../binding/ManagedFactory":13,"./ManagedType":41,"./Type":48}],39:[function(a,b,c){var d=a("../binding"),e=a("./SingularAttribute").SingularAttribute,f=a("./BasicType").BasicType,g=a("./Type").Type,h=a("./ManagedType").ManagedType,i=a("../util/Metadata").Metadata,j=a("../util/Permission").Permission;c.EntityType=EntityType=h.inherit({persistenceType:g.PersistenceType.ENTITY,declaredId:null,declaredVersion:null,superType:null,get id(){return this.declaredId||this.superType.id},get version(){return this.declaredVersion||this.superType.version},updatePermission:null,createPermission:null,deletePermission:null,queryPermission:null,schemaSubclassPermission:null,initialize:function(a,b,c){this.superCall(a,c),this.superType=b,this.createPermission=new j,this.updatePermission=new j,this.deletePermission=new j,this.queryPermission=new j,this.schemaSubclassPermission=new j},createObjectFactory:function(a){if(this.isNative)switch(this.name){case"_native.User":return d.UserFactory.create(this,a);case"_native.Object":return void 0}return d.EntityFactory.create(this,a)},fromDatabaseValue:function(a,b,c){return a._root==c?this.superCall(a,b,c):b?a.db.getReference(b):null},toDatabaseValue:function(a,b){return a._root==b?this.superCall(a,b):this.typeConstructor.isInstance(b)?(b.attach(a.db),i.get(b).ref):null},toString:function(){return"EntityType("+this.ref+")"},toJSON:function(){var a=this.superCall();return a.acl.schemaSubclass=this.schemaSubclassPermission,a.acl.create=this.createPermission,a.acl.update=this.updatePermission,a.acl.delete=this.deletePermission,a.acl.query=this.queryPermission,a}}),EntityType.extend({Object:EntityType.inherit({extend:{ref:"/db/_native.Object"},declaredAttributes:[],initialize:function(){this.superCall(EntityType.Object.ref,null,Object),this.declaredId=new e(this,"id",f.String),this.declaredId.isId=!0,this.declaredVersion=new e(this,"version",f.String),this.declaredVersion.isVersion=!0}})})},{"../binding":17,"../util/Metadata":52,"../util/Permission":53,"./BasicType":35,"./ManagedType":41,"./SingularAttribute":47,"./Type":48}],40:[function(a,b,c){var d,e=a("./PluralAttribute").PluralAttribute,f=a("../collection");c.ListAttribute=d=e.inherit({extend:{ref:"/db/_native.collection.List"},collectionType:e.CollectionType.LIST,initialize:function(a,b,c){this.superCall(a,b,c),this.typeConstructor=f.List},toJSON:function(){return{name:this.name,type:d.ref+"["+this.elementType.ref+"]"}}})},{"../collection":18,"./PluralAttribute":45}],41:[function(a,b,c){var d=a("./Type").Type,e=a("../util/Permission").Permission,f=a("../collection");c.ManagedType=ManagedType=d.inherit({AttributeIterator:Object.inherit(f.Iterator,{index:0,initialize:function(a){this.type=a},next:function(){for(;this.type&&this.type.declaredAttributes.length==this.index;)this.type=this.type.superType,this.index=0;return this.type?{done:!1,value:this.type.declaredAttributes[this.index++]}:{done:!0}}}),_enhancer:null,declaredAttributes:null,superType:null,loadPermission:null,schemaAddPermission:null,schemaReplacePermission:null,set validationCode(a){if(a){if(String.isInstance(a)){for(var b=[],c=this.attributes(),d=c.next();!d.done;d=c.next())b.push(d.value.name);a=new Function(b,a)}}else a=null;this._validationCode=a},get validationCode(){return this._validationCode},_validationCode:null,get typeConstructor(){return this._typeConstructor||(this.typeConstructor=this._enhancer.createProxyClass(this)),this._typeConstructor},set typeConstructor(a){if(this._typeConstructor)throw new Error("typeConstructor has already been set.");this._typeConstructor=a,this._enhancer.enhance(this,this._typeConstructor)},initialize:function(a,b){this.superCall(0!=a.indexOf("/db/")?"/db/"+a:a,b),this.declaredAttributes=[],this.loadPermission=new e,this.schemaAddPermission=new e,this.schemaReplacePermission=new e},init:function(a){this._enhancer=a,this._typeConstructor&&!this._enhancer.getIdentifier(this._typeConstructor)&&this._enhancer.setIdentifier(this._typeConstructor,this.ref)},createObjectFactory:function(){},create:function(){return this._enhancer.create(this)},attributes:function(){return new this.AttributeIterator(this)},getAttribute:function(a){var b=this.getDeclaredAttribute(a);return!b&&this.superType&&(b=this.superType.getAttribute(a)),b},getDeclaredAttribute:function(a){for(var b,c=0;b=this.declaredAttributes[c];++c)if(b.name==a)return b;return null},fromDatabaseValue:function(a,b,c){if(b)for(var d=this.attributes(),e=d.next();!e.done;e=d.next()){var f=e.value;f.setDatabaseValue(a,c,b[f.name])}else c=null;return c},toDatabaseValue:function(a,b){var c=null;if(this.typeConstructor.isInstance(b)){c={};for(var d=this.attributes(),e=d.next();!e.done;e=d.next()){var f=e.value;c[f.name]=f.getDatabaseValue(a,b)}}return c},toJSON:function(){var a={};a["class"]=this.ref,this.superType&&(a.superClass=this.superType.ref),this.isEmbeddable&&(a.embedded=!0),a.acl={load:this.loadPermission,schemaAdd:this.schemaAddPermission,schemaReplace:this.schemaReplacePermission};for(var b,c=a.fields={},d=0;b=this.declaredAttributes[d];d++)c[b.name]=b;return a},references:function(){return new this.ReferenceIterator(this)},ReferenceIterator:Object.inherit({initialize:function(a){this.type=a,this.attributes=this.type.attributes(),this.embedded=[]},next:function(){for(var a=this.attributes,b=a.next();!b.done;b=a.next()){var c=b.value,d=c.isCollection?c.elementType:c.type;if(d.isEntity)return{done:!1,value:{path:[c.name]}};if(d.isEmbeddable)for(var e=d.references(),f=e.next();!f.done;f=e.next())this.embedded.push({done:!1,value:{path:[c.name].concat(f.value.path)}})}return this.embedded.length?this.embedded.pop():{done:!0}}})})},{"../collection":18,"../util/Permission":53,"./Type":48}],42:[function(a,b,c){var d,e=a("./PluralAttribute").PluralAttribute,f=a("../collection");c.MapAttribute=d=e.inherit({extend:{ref:"/db/_native.collection.Map"},collectionType:e.CollectionType.MAP,keyType:null,initialize:function(a,b,c,d){this.superCall(a,b,d),this.keyType=c,this.typeConstructor=f.Map},getDatabaseValue:function(a,b){var c=this.getValue(b);if(c){c._metadata||Object.defineProperty(c,"_metadata",{value:{_root:a._root}});for(var d={},e=c.items(),f=e.next();!f.done;f=e.next()){if(null===f.index||void 0===f.index)throw new baqend.error.PersistentError("Map keys can't be null nor undefined.");d[this.keyType.toDatabaseValue(a,f.index)]=this.elementType.toDatabaseValue(a,f.value)}return d}return null},setDatabaseValue:function(a,b,c){var d=null;if(c){d=this.getValue(b),this.typeConstructor.isInstance(d)||(d=new this.typeConstructor,Object.defineProperty(d,"_metadata",{value:{_root:a._root}}));var e=d.seq,f=d.vals;d.seq=[],d.vals=[],d.size=0;for(var g in c){g=this.keyType.fromDatabaseValue(a,g);var h=e.indexOf(g),i=this.elementType.fromDatabaseValue(a,c[g],-1!=h?f[h]:null);d.set(g,i)}}this.setValue(b,d)},toJSON:function(){return{name:this.name,type:d.ref+"["+this.keyType.ref+","+this.elementType.ref+"]"}}})},{"../collection":18,"./PluralAttribute":45}],43:[function(a,b,c){var d=(a("./BasicType").BasicType,a("./ManagedType").ManagedType),e=a("./EntityType").EntityType,f=a("../binding").Enhancer,g=a("./ModelBuilder").ModelBuilder,h=a("../message");c.Metamodel=Metamodel=Object.inherit({_isFinalized:!1,_connector:null,entities:null,embeddables:null,baseTypes:null,initialize:function(a){this._connector=a,this._enhancer=new f},init:function(a){if(this.entities)throw new Error("Metamodel is already initialized.");this.fromJSON(a||[]),this._saveLoadPromise=Promise.resolve(this)},_getRef:function(a){var b;return String.isInstance(a)?(b=a,0!=b.indexOf("/db/")&&(b="/db/"+a)):b=this._enhancer.getIdentifier(a),b},entity:function(a){var b=this._getRef(a);return b?this.entities[b]:null},baseType:function(a){var b=null;if(String.isInstance(a)&&-1==a.indexOf("_native."))b="/db/_native."+a;else if(String.isInstance(a))b=this._getRef(a);else for(var c in this.baseTypes){var d=this.baseTypes[c];if(!d.noResolving&&d.typeConstructor==a){b=c;break}}return b?this.baseTypes[b]:null},embeddable:function(a){var b=this._getRef(a);return b?this.embeddables[b]:null},managedType:function(a){return this.baseType(a)||this.entity(a)||this.embeddable(a)},addType:function(a){var b;if(a.isBasic?b=this.baseTypes:a.isEmbeddable?(a.init(this._enhancer),b=this.embeddables):a.isEntity&&(a.init(this._enhancer),b=this.entities,null==a.superType&&a.ref!=e.Object.ref&&(a.superType=this.entity(e.Object.ref))),b[a.ref])throw new Error("The type "+a.ref+" is already declared.");return b[a.ref]=a},load:function(){if(this._saveLoadPromise||this._isFinalized)throw new Error("Metamodel has already been set.");var a=new h.GetAllSchemas;return this._saveLoadPromise=this._connector.send(a).then(function(a){return this.fromJSON(a.response.entity),this}.bind(this))},save:function(a,b,c){if(this._isFinalized)throw new Error("Metamodel is already used by an EntityManager instance.");if(!this._saveLoadPromise)throw new Error("Metamodel is not initialized.");d.isInstance(a)||(c=b,b=a,a=null);var e;return e=a?b?new h.ReplaceSchema(a.name,a.toJSON()):new h.UpdateSchema(a.name,a.toJSON()):b?new h.ReplaceAllSchemas(this.toJSON()):new h.UpdateAllSchemas(this.toJSON()),e.withAuthorizationToken(c||!0),this._saveLoadPromise=this._saveLoadPromise.then(function(){return this._connector.send(e)}.bind(this)).then(function(){return this}.bind(this)),this._saveLoadPromise},ready:function(){return this._saveLoadPromise||this.load(),this._isFinalized=!0,this._saveLoadPromise},toJSON:function(){var a=[];for(var b in this.entities)a.push(this.entities[b]);for(b in this.embeddables)a.push(this.embeddables[b]);return a},fromJSON:function(a){var b=new g,c=b.buildModels(a);this.baseTypes={},this.embeddables={},this.entities={};for(var d in c){var e=c[d];this.addType(e)}}})},{"../binding":17,"../message":33,"./BasicType":35,"./EntityType":39,"./ManagedType":41,"./ModelBuilder":44}],44:[function(a,b,c){var d=a("./BasicType").BasicType,e=a("./EntityType").EntityType,f=a("./EmbeddableType").EmbeddableType,g=a("./ListAttribute").ListAttribute,h=a("./MapAttribute").MapAttribute,i=a("./SetAttribute").SetAttribute,j=a("./SingularAttribute").SingularAttribute,k=a("../error").PersistentError;c.ModelBuilder=ModelBuilder=Object.inherit({models:null,modelDescriptors:null,initialize:function(){this.models={};for(var a in d)if(d.hasOwnProperty(a)){var b=d[a];b instanceof d&&(this.models[b.ref]=b)}},getModel:function(a){return a in this.models?this.models[a]:this.models[a]=this.buildModel(a)},buildModels:function(a){this.modelDescriptors={};for(var b,c=0;b=a[c];++c)this.modelDescriptors[b["class"]]=b;for(var d in this.modelDescriptors)try{var f=this.getModel(d);this.buildAttributes(f)}catch(g){throw new k("Can't create model for entity class "+d,g)}return this.getModel(e.Object.ref),this.models},buildModel:function(a){if(a==e.Object.ref)return new e.Object;if(!(a in this.modelDescriptors))throw new TypeError("No model available for "+a);var b=this.modelDescriptors[a];if(b){var c;if(b.embedded)c=new f(a);else{var d=b.superClass||e.Object.ref;c=new e(a,this.getModel(d))}var g=b.acl;for(var h in g)c[h+"Permission"].fromJSON(g[h]);return c}},buildAttributes:function(a){var b=this.modelDescriptors[a.ref],c=b.fields,d=a.declaredAttributes,e=[];for(var f in c){e.push(f);var g=c[f];d.push(this.buildAttribute(a,g.name,g.type))}b.validationCode&&(a.validationCode=new Function(e,b.validationCode))},buildAttribute:function(a,b,c){if(0!=c.indexOf("/db/_native.collection"))return new j(a,b,this.getModel(c));var d=c.substring(0,c.indexOf("[")),e=c.substring(c.indexOf("[")+1,c.indexOf("]")).trim();switch(d){case g.ref:return new g(a,b,this.getModel(e));case i.ref:return new i(a,b,this.getModel(e));case h.ref:var f=e.substring(0,e.indexOf(",")).trim();return e=e.substring(e.indexOf(",")+1).trim(),new h(a,b,this.getModel(f),this.getModel(e));default:throw new TypeError("No collection available for "+c)}}})},{"../error":31,"./BasicType":35,"./EmbeddableType":38,"./EntityType":39,"./ListAttribute":40,"./MapAttribute":42,"./SetAttribute":46,"./SingularAttribute":47}],45:[function(a,b,c){var d=a("./Attribute").Attribute;c.PluralAttribute=PluralAttribute=d.inherit({extend:{CollectionType:{COLLECTION:0,LIST:1,MAP:2,SET:3}},typeConstructor:null,persistentAttributeType:d.PersistentAttributeType.ELEMENT_COLLECTION,elementType:null,initialize:function(a,b,c){this.superCall(a,b),this.elementType=c},getDatabaseValue:function(a,b){var c=this.getValue(b);if(this.typeConstructor.isInstance(c)){c._metadata||Object.defineProperty(c,"_metadata",{value:{_root:a._root}});for(var d=[],e=c.iterator(),f=e.next();!f.done;f=e.next())d.push(this.elementType.toDatabaseValue(a,f.value));return d}return null},setDatabaseValue:function(a,b,c){var d=null;if(c){d=this.getValue(b),this.typeConstructor.isInstance(d)||(d=new this.typeConstructor,Object.defineProperty(d,"_metadata",{value:{_root:a._root}}));var e=d.seq;d.seq=[],d.size=0;for(var f=0,g=c.length;g>f;++f)d.add(this.elementType.fromDatabaseValue(a,c[f],e[f]))}this.setValue(b,d)}})},{"./Attribute":34}],46:[function(a,b,c){var d,e=a("./PluralAttribute").PluralAttribute,f=a("../collection");
c.SetAttribute=d=e.inherit({extend:{ref:"/db/_native.collection.Set"},collectionType:e.CollectionType.SET,initialize:function(a,b,c){this.superCall(a,b,c),this.typeConstructor=f.Set},toJSON:function(){return{name:this.name,type:d.ref+"["+this.elementType.ref+"]"}}})},{"../collection":18,"./PluralAttribute":45}],47:[function(a,b,c){var d=a("./Attribute").Attribute,e=a("./Type").Type;c.SingularAttribute=SingularAttribute=d.inherit({get typeConstructor(){return this.type.typeConstructor},type:null,initialize:function(a,b,c){switch(this.superCall(a,b),this.type=c,c.persistenceType){case e.PersistenceType.BASIC:this.persistentAttributeType=d.PersistentAttributeType.BASIC;break;case e.PersistenceType.EMBEDDABLE:this.persistentAttributeType=d.PersistentAttributeType.EMBEDDED;break;case e.PersistenceType.ENTITY:this.persistentAttributeType=d.PersistentAttributeType.ONE_TO_MANY}},getDatabaseValue:function(a,b){return this.type.toDatabaseValue(a,this.getValue(b))},setDatabaseValue:function(a,b,c){this.setValue(b,this.type.fromDatabaseValue(a,c,this.getValue(b)))},toJSON:function(){return{name:this.name,type:this.type.ref}}})},{"./Attribute":34,"./Type":48}],48:[function(a,b,c){var d;c.Type=d=Object.inherit({extend:{PersistenceType:{BASIC:0,EMBEDDABLE:1,ENTITY:2,MAPPED_SUPERCLASS:3}},get isBasic(){return this.persistenceType==d.PersistenceType.BASIC},get isEmbeddable(){return this.persistenceType==d.PersistenceType.EMBEDDABLE},get isEntity(){return this.persistenceType==d.PersistenceType.ENTITY},get isNative(){return 0==this.ref.indexOf("/db/_native")},get isMappedSuperclass(){return this.persistenceType==d.PersistenceType.MAPPED_SUPERCLASS},persistenceType:-1,get typeConstructor(){return this._typeConstructor},set typeConstructor(a){if(this._typeConstructor)throw new Error("typeConstructor has already been set.");this._typeConstructor=a},ref:null,name:null,initialize:function(a,b){if(0!=a.indexOf("/db/"))throw new SyntaxError("Type ref "+a+" is invalid.");this.ref=a,this.name=a.substring(4),this._typeConstructor=b},fromDatabaseValue:function(){},toDatabaseValue:function(){}})},{}],49:[function(a,b,c){c.Attribute=a("./Attribute").Attribute,c.BasicType=a("./BasicType").BasicType,c.CollectionAttribute=a("./CollectionAttribute").CollectionAttribute,c.EmbeddableType=a("./EmbeddableType").EmbeddableType,c.EntityType=a("./EntityType").EntityType,c.ListAttribute=a("./ListAttribute").ListAttribute,c.ManagedType=a("./ManagedType").ManagedType,c.MapAttribute=a("./MapAttribute").MapAttribute,c.Metamodel=a("./Metamodel").Metamodel,c.Code=a("./Code").Code,c.ModelBuilder=a("./ModelBuilder").ModelBuilder,c.PluralAttribute=a("./PluralAttribute").PluralAttribute,c.SetAttribute=a("./SetAttribute").SetAttribute,c.SingularAttribute=a("./SingularAttribute").SingularAttribute,c.Type=a("./Type").Type},{"./Attribute":34,"./BasicType":35,"./Code":36,"./CollectionAttribute":37,"./EmbeddableType":38,"./EntityType":39,"./ListAttribute":40,"./ManagedType":41,"./MapAttribute":42,"./Metamodel":43,"./ModelBuilder":44,"./PluralAttribute":45,"./SetAttribute":46,"./SingularAttribute":47,"./Type":48}],50:[function(){Function.prototype.bind=Function.prototype.bind||function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}},{}],51:[function(a,b,c){var d,e=a("./Permission").Permission;c.Acl=d=Object.inherit({read:null,write:null,initialize:function(a){this.read=new e(a),this.write=new e(a)},clear:function(){this.read.clear(),this.write.clear()},isPublicReadAllowed:function(){return this.read.isPublicAllowed()},setPublicReadAllowed:function(){return this.read.setPublicAllowed()},isReadAllowed:function(a){return this.read.isAllowed(a)},isReadDenied:function(a){return this.read.isDenied(a)},allowReadAccess:function(a){return this.read.allowAccess(a),this},denyReadAccess:function(a){return this.read.denyAccess(a),this},deleteReadAccess:function(a){return this.read.deleteAccess(a),this},isPublicWriteAllowed:function(){return this.write.isPublicAllowed()},setPublicWriteAllowed:function(){return this.write.setPublicAllowed()},isWriteAllowed:function(a){return this.write.isAllowed(a)},isWriteDenied:function(a){return this.write.isDenied(a)},allowWriteAccess:function(a){return this.write.allowAccess(a),this},denyWriteAccess:function(a){return this.write.denyAccess(a),this},deleteWriteAccess:function(a){return this.write.deleteAccess(a),this},toJSON:function(){return{read:this.read,write:this.write}},fromJSON:function(a){this.read.fromJSON(a.read),this.write.fromJSON(a.write)}})},{"./Permission":53}],52:[function(a,b,c){var d,e=a("../error").PersistentError,f=a("./Acl").Acl;c.Metadata=d=Object.inherit({extend:{Type:{UNAVAILABLE:-1,PERSISTENT:0,DIRTY:1},get:function(a){return a&&a._metadata||null},getRoot:function(a){var b=a&&a._metadata;return b&&b._root!=a&&(b=b._root&&b._root._metadata),b},readAccess:function(a){var b=d.getRoot(a);b&&b.readAccess()},writeAccess:function(a){var b=d.getRoot(a);b&&b.writeAccess()}},get db(){var a="undefined"!=typeof window?window:global;if(!a.DB||a.DB.connect)throw new e("No database context is set.");return this.db=a.DB},set db(a){Object.defineProperty(this,"db",{value:a})},get type(){if(!this.isAttached)return null;var a=this.db.metamodel.entity(this._root.constructor);return a&&Object.defineProperty(this,"type",{value:a}),a},get bucket(){return this.type&&this.type.name},get ref(){return this.isAttached&&this.id?"/db/"+this.bucket+"/"+encodeURIComponent(this.id):null},get isAttached(){return this.hasOwnProperty("db")},get isAvailable(){return this._state>d.Type.UNAVAILABLE},get isPersistent(){return this._state==d.Type.PERSISTENT},get isDirty(){return this._state==d.Type.DIRTY},get acl(){var a=new f(this);return Object.defineProperty(this,"acl",{value:a}),a},_root:null,id:null,version:null,initialize:function(a){this._root=a,this._state=d.Type.DIRTY,this._enabled=!0},readAccess:function(){if(this._enabled&&!this.isAvailable)throw new e("This object "+this.bucket+"/"+this.id+" is not available.")},writeAccess:function(){if(this._enabled){if(!this.isAvailable)throw new e("This object "+this.bucket+"/"+this.id+" is not available.");this.setDirty()}},setUnavailable:function(){this._state=d.Type.UNAVAILABLE},setPersistent:function(){this._state=d.Type.PERSISTENT},setDirty:function(){this._state=d.Type.DIRTY},setRemoved:function(){this.setDirty(),this.version=null},getDatabaseObjectInfo:function(a){var b={bucket:this.type.name};return this.id&&(b.id=this.id),!a&&this.version&&(b.version=this.version),this.db.transaction.isActive&&(b.transaction="/transaction/"+this.db.transaction.tid),b.acl=this.acl,b},setDatabaseObjectInfo:function(a){this.id||(this.id=a.id),a.version&&(this.version=a.version),this.acl.fromJSON(a.acl||{})},getDatabaseObject:function(a,b){this._enabled=!1;var c=this.type.toDatabaseValue(this,this._root);return this._enabled=!0,this.isAttached&&!b&&(c._objectInfo=this.getDatabaseObjectInfo(a)),c},setDatabaseObject:function(a){a._objectInfo&&this.setDatabaseObjectInfo(a._objectInfo),this._enabled=!1,this.type.fromDatabaseValue(this,a,this._root),this._enabled=!0}})},{"../error":31,"./Acl":51}],53:[function(a,b,c){var d;c.Permission=d=Object.inherit({_metadata:null,_rules:null,initialize:function(a){this._rules={},this._metadata=a},clear:function(){this._metadata&&this._metadata.writeAccess(),this._rules={}},isPublicAllowed:function(){for(var a in this._rules)if("allow"==this._rules[a])return!1;return!0},setPublicAllowed:function(){this._metadata&&this._metadata.writeAccess();for(var a in this._rules)"allow"==this._rules[a]&&delete this._rules[a]},isAllowed:function(a){return"allow"==this._rules[this._getRef(a)]},isDenied:function(a){return"deny"==this._rules[this._getRef(a)]},allowAccess:function(a){return this._metadata&&this._metadata.writeAccess(),this._rules[this._getRef(a)]="allow",this},denyAccess:function(a){return this._metadata&&this._metadata.writeAccess(),this._rules[this._getRef(a)]="deny",this},deleteAccess:function(a){return this._metadata&&this._metadata.writeAccess(),delete this._rules[this._getRef(a)],this},toJSON:function(){return this._rules},fromJSON:function(a){this._rules=a},_getRef:function(a){if(String.isInstance(a)||(a=a._metadata.ref),a.indexOf("/db/_native.User/")||a.indexOf("/db/_native.Role/"))return a;throw new TypeError("The given object isn't a user, role or a valid reference.")}})},{}],54:[function(a,b,c){var d,e,f=a("validator");c.Validator=d=Object.inherit({extend:{initialize:function(){Object.keys(f).forEach(function(a){"function"==typeof f[a]&&"toString"!==a&&"toDate"!==a&&"extend"!==a&&"init"!==a&&(this.prototype[a]=function(b){return this._callMethod(a,b||a,Array.prototype.slice.call(arguments,b?1:0))})}.bind(this))}},key:null,errors:null,_entity:null,get value(){return this._entity[this.key]},get isValid(){return 0==this.errors.length},is:function(a,b){return Function.isInstance(a)&&(b=a,a="is"),b(this.value)===!1&&this.errors.push(a),this},initialize:function(a,b){this.key=a,this._entity=b,this.errors=[]},_callMethod:function(a,b,c){return c=c||[],c.unshift(this.value),f[a].apply(this,c)===!1&&this.errors.push(b),this},toString:function(){return this.value},toJSON:function(){return{isValid:this.isValid,errors:this.errors}}}),c.ValidationResult=e=Object.inherit({fields:null,get isValid(){for(var a in this.fields)if(!this.fields[a].isValid)return!1;return!0},initialize:function(){this.fields={}},toJSON:function(){var a={};for(var b in this.fields)a[b]=this.fields[b].toJSON();return a}})},{validator:77}],55:[function(a,b,c){c.Metadata=a("./Metadata").Metadata,c.Permission=a("./Permission").Permission,c.Acl=a("./Acl").Acl,c.Validator=a("./Validator").Validator,c.ValidationResult=a("./Validator").ValidationResult},{"./Acl":51,"./Metadata":52,"./Permission":53,"./Validator":54}],56:[function(){},{}],57:[function(){!function(a){var b=Object.getPrototypeOf({constructor:String})==String.prototype;Function.prototype.extend||(Function.prototype.extend=function(a,b){b||(b=a,a=this);for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}),Object.extend(Function.prototype,{linearizedTypes:[Object],inherit:function(){for(var a=function(b){return this instanceof a?void(this.initialize&&(arguments.length?this.initialize.apply(this,arguments):this.initialize.call(this))):a.asInstance(b)},b=arguments[arguments.length-1],c=Object.createPrototypeChain(a,this,Array.prototype.slice.call(arguments,0,arguments.length-1)),d=Object.getOwnPropertyNames(b),e=0;e<d.length;++e){var f=d[e],g=!1;if(Object.properties.hasOwnProperty(f)&&(g=Object.properties[f](c,b,f)),!g){var h=Object.getOwnPropertyDescriptor(b,f);if(h.value){var i=h.value;i instanceof Function?/this\.superCall/.test(i.toString())&&(h.value=Object.createSuperCallWrapper(a,f,i)):i&&(i.hasOwnProperty("get")||i.hasOwnProperty("value"))&&(h=i)}Object.defineProperty(c,f,h)}}return a.initialize&&a.initialize(),a},isInstance:function(a){return null===a||void 0===a?!1:Object(a)instanceof this||-1!=d(a).linearizedTypes.lastIndexOf(this)},asInstance:function(a){return this.isInstance(a)?a:this.conv(a)},conv:function(){return null}}),Object.extend({properties:{},cloneOwnProperties:function(a,b){for(var c=Object.getOwnPropertyNames(b),d=0;d<c.length;++d){var e=c[d];if("__proto__"!=e){var f=Object.getOwnPropertyDescriptor(b,e);Object.defineProperty(a,e,f)}}},createPrototypeChain:function(a,c,d){for(var f,g=c.prototype,h=c.linearizedTypes.slice(),i=c.prototypeChain?c.prototypeChain.slice():[g],j=0;f=d[j];++j){if(!(f.prototype instanceof e))throw new TypeError("Only traits can be mixed in.");for(var k,l=f.linearizedTypes,m=0;k=l[m];++m)-1==h.indexOf(k)&&k!=e&&(g=Object.create(g),Object.cloneOwnProperties(g,k.wrappedPrototype?k.wrappedPrototype:k.prototype),g.constructor=k,h.push(k),i.push(g))}return g=Object.create(g),g.constructor=a,h.push(a),i.push(g),b?(a.wrappedPrototype=g,a.prototype=Object.create(g)):a.prototype=g,a.linearizedTypes=h,a.prototypeChain=i,g},createSuperCallWrapper:function(a,b,c){var e=function(){var c=d(this),e=c.linearizedTypes.lastIndexOf(a);if(-1==e)throw new ReferenceError("superCall can't determine any super method");var f=c.prototypeChain[e-1];return"initialize"!=b||f[b]?arguments.length?f[b].apply(this,arguments):f[b].call(this):void 0};return function(){var a=this.superCall;this.superCall=e;try{return arguments.length?c.apply(this,arguments):c.call(this)}finally{a?this.superCall=a:delete this.superCall}}}}),Object.extend(Object.properties,{initialize:function(a,b){var c=b.initialize,f=/this\.superCall/.test(c.toString());if(a instanceof e){if(f)throw new TypeError("Trait constructors can not call super constructors directly.");b.initialize=function(){arguments.length?this.superCall.apply(this,arguments):this.superCall.call(this),c.call(this)}}else f||d(a)==Object||(b.initialize=function(){this.superCall.call(this),arguments.length?c.apply(this,arguments):c.call(this)})},extend:function(a,b){return Object.extend(a.constructor,b.extend),!0}});for(var c,d=function(a){return Object.getPrototypeOf(Object(a)).constructor},e=Object.inherit({}),f=(e.inherit({extend:{initialize:function(){try{Object.defineProperty(this.prototype,"bind",{get:function(){return this.bind=f.create(this)},set:function(a){Object.defineProperty(this,"bind",{value:a})},configurable:!0}),this.Object=Object.inherit({initialize:function(a){this.self=a}})}catch(a){this.Object=Object.inherit({initialize:function(a){this.self=a;var b=this;f.each(a,function(a,c){b[a]=c.bind(b.self)})}})}},create:function(a){if(!a.constructor.Bind)try{var b={};f.each(a,function(a,c){b[a]={get:function(){return this[a]=c.bind(this.self)},set:function(b){Object.defineProperty(this,a,{value:b})},configurable:!0}}),a.constructor.Bind=f.Object.inherit(b)}catch(c){a.constructor.Bind=f.Object.inherit({})}return new a.constructor.Bind(a)},each:function(a,b){var c=Object.getPrototypeOf(a);for(var d in c){var e=c[d];"initialize"!=d&&e instanceof Function&&b(d,e)}}},initialize:function(){"bind"in this||(this.bind=f.create(this))}})),g=[Boolean,Number,String,Function,RegExp,Error],h=0;c=g[h];++h)c.conv=c;Date.conv=function(a){return new Date(a)},Array.conv=function(a){return Array.prototype.slice.call(a)},Array.prototype.initialize=function(){for(var a=0;a<arguments.length;++a)this[a]=arguments[a];this.length=arguments.length},Error.prototype.initialize=function(a){var b=(new Error).stack||"Error";b=b.substring(b.indexOf("\n")+1),this.stack=a+"\n"+b,this.message=a},TypeError instanceof Error&&(Error.prototype.isInstance=Error.isInstance,Error.prototype.asInstance=Error.asInstance,Error.prototype.conv=Error.conv),Object.extend(a,{classOf:d,Trait:e,Bind:f})}("undefined"!=typeof window?window:global)},{}],58:[function(a,b){"use strict";function c(){}b.exports=c},{}],59:[function(a,b){"use strict";function c(a){function b(a,b){function d(a){j[b]=a,++k===c&!i&&(i=!0,h.resolve(m,j))}f(a).then(d,function(a){i||(i=!0,h.reject(m,a))})}if("[object Array]"!==Object.prototype.toString.call(a))return e(new TypeError("must be an array"));var c=a.length,i=!1;if(!c)return f([]);for(var j=new Array(c),k=0,l=-1,m=new d(g);++l<c;)b(a[l],l);return m}var d=a("./promise"),e=a("./reject"),f=a("./resolve"),g=a("./INTERNAL"),h=a("./handlers");b.exports=c},{"./INTERNAL":58,"./handlers":60,"./promise":62,"./reject":65,"./resolve":66}],60:[function(a,b,c){"use strict";function d(a){var b=a&&a.then;return a&&"object"==typeof a&&"function"==typeof b?function(){b.apply(a,arguments)}:void 0}var e=a("./tryCatch"),f=a("./resolveThenable"),g=a("./states");c.resolve=function(a,b){var h=e(d,b);if("error"===h.status)return c.reject(a,h.value);var i=h.value;if(i)f.safely(a,i);else{a.state=g.FULFILLED,a.outcome=b;for(var j=-1,k=a.queue.length;++j<k;)a.queue[j].callFulfilled(b)}return a},c.reject=function(a,b){a.state=g.REJECTED,a.outcome=b;for(var c=-1,d=a.queue.length;++c<d;)a.queue[c].callRejected(b);return a}},{"./resolveThenable":67,"./states":68,"./tryCatch":69}],61:[function(a,b,c){b.exports=c=a("./promise"),c.resolve=a("./resolve"),c.reject=a("./reject"),c.all=a("./all"),c.race=a("./race")},{"./all":59,"./promise":62,"./race":64,"./reject":65,"./resolve":66}],62:[function(a,b){"use strict";function c(a){if(!(this instanceof c))return new c(a);if("function"!=typeof a)throw new TypeError("reslover must be a function");this.state=g.PENDING,this.queue=[],this.outcome=void 0,a!==e&&f.safely(this,a)}var d=a("./unwrap"),e=a("./INTERNAL"),f=a("./resolveThenable"),g=a("./states"),h=a("./queueItem");b.exports=c,c.prototype["catch"]=function(a){return this.then(null,a)},c.prototype.then=function(a,b){if("function"!=typeof a&&this.state===g.FULFILLED||"function"!=typeof b&&this.state===g.REJECTED)return this;var f=new c(e);if(this.state!==g.PENDING){var i=this.state===g.FULFILLED?a:b;d(f,i,this.outcome)}else this.queue.push(new h(f,a,b));return f}},{"./INTERNAL":58,"./queueItem":63,"./resolveThenable":67,"./states":68,"./unwrap":70}],63:[function(a,b){"use strict";function c(a,b,c){this.promise=a,"function"==typeof b&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),"function"==typeof c&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}var d=a("./handlers"),e=a("./unwrap");b.exports=c,c.prototype.callFulfilled=function(a){d.resolve(this.promise,a)},c.prototype.otherCallFulfilled=function(a){e(this.promise,this.onFulfilled,a)},c.prototype.callRejected=function(a){d.reject(this.promise,a)},c.prototype.otherCallRejected=function(a){e(this.promise,this.onRejected,a)}},{"./handlers":60,"./unwrap":70}],64:[function(a,b){"use strict";function c(a){function b(a){f(a).then(function(a){i||(i=!0,h.resolve(k,a))},function(a){i||(i=!0,h.reject(k,a))})}if("[object Array]"!==Object.prototype.toString.call(a))return e(new TypeError("must be an array"));var c=a.length,i=!1;if(!c)return f([]);for(var j=-1,k=new d(g);++j<c;)b(a[j]);return k}var d=a("./promise"),e=a("./reject"),f=a("./resolve"),g=a("./INTERNAL"),h=a("./handlers");b.exports=c},{"./INTERNAL":58,"./handlers":60,"./promise":62,"./reject":65,"./resolve":66}],65:[function(a,b){"use strict";function c(a){var b=new d(e);return f.reject(b,a)}var d=a("./promise"),e=a("./INTERNAL"),f=a("./handlers");b.exports=c},{"./INTERNAL":58,"./handlers":60,"./promise":62}],66:[function(a,b){"use strict";function c(a){if(a)return a instanceof d?a:f.resolve(new d(e),a);var b=typeof a;switch(b){case"boolean":return g;case"undefined":return i;case"object":return h;case"number":return j;case"string":return k}}var d=a("./promise"),e=a("./INTERNAL"),f=a("./handlers");b.exports=c;var g=f.resolve(new d(e),!1),h=f.resolve(new d(e),null),i=f.resolve(new d(e),void 0),j=f.resolve(new d(e),0),k=f.resolve(new d(e),"")},{"./INTERNAL":58,"./handlers":60,"./promise":62}],67:[function(a,b,c){"use strict";function d(a,b){function c(b){h||(h=!0,e.reject(a,b))}function d(b){h||(h=!0,e.resolve(a,b))}function g(){b(d,c)}var h=!1,i=f(g);"error"===i.status&&c(i.value)}var e=a("./handlers"),f=a("./tryCatch");c.safely=d},{"./handlers":60,"./tryCatch":69}],68:[function(a,b,c){c.REJECTED=["REJECTED"],c.FULFILLED=["FULFILLED"],c.PENDING=["PENDING"]},{}],69:[function(a,b){"use strict";function c(a,b){var c={};try{c.value=a(b),c.status="success"}catch(d){c.status="error",c.value=d}return c}b.exports=c},{}],70:[function(a,b){"use strict";function c(a,b,c){d(function(){var d;try{d=b(c)}catch(f){return e.reject(a,f)}d===a?e.reject(a,new TypeError("Cannot resolve promise with itself")):e.resolve(a,d)})}var d=a("immediate"),e=a("./handlers");b.exports=c},{"./handlers":60,immediate:71}],71:[function(a,b){"use strict";function c(){e=!0;for(var a,b,c=h.length;c;){for(b=h,h=[],a=-1;++a<c;)b[a]();c=h.length}e=!1}function d(a){1!==h.push(a)||e||f()}for(var e,f,g=[a("./nextTick"),a("./mutation.js"),a("./messageChannel"),a("./stateChange"),a("./timeout")],h=[],i=-1,j=g.length;++i<j;)if(g[i]&&g[i].test&&g[i].test()){f=g[i].install(c);break}b.exports=d},{"./messageChannel":72,"./mutation.js":73,"./nextTick":56,"./stateChange":74,"./timeout":75}],72:[function(a,b,c){"use strict";c.test=function(){return global.setImmediate?!1:"undefined"!=typeof global.MessageChannel},c.install=function(a){var b=new global.MessageChannel;return b.port1.onmessage=a,function(){b.port2.postMessage(0)}}},{}],73:[function(a,b,c){"use strict";var d=global.MutationObserver||global.WebKitMutationObserver;c.test=function(){return d},c.install=function(a){var b=0,c=new d(a),e=global.document.createTextNode("");return c.observe(e,{characterData:!0}),function(){e.data=b=++b%2}}},{}],74:[function(a,b,c){"use strict";c.test=function(){return"document"in global&&"onreadystatechange"in global.document.createElement("script")},c.install=function(a){return function(){var b=global.document.createElement("script");return b.onreadystatechange=function(){a(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},global.document.documentElement.appendChild(b),a}}},{}],75:[function(a,b,c){"use strict";c.test=function(){return!0},c.install=function(a){return function(){setTimeout(a,0)}}},{}],76:[function(b,c){(function(){function b(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){16>e&&(b[d+e++]=o[a])});16>e;)b[d+e++]=0;return b}function d(a,b){var c=b||0,d=n;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function e(a,b,c){var e=b&&c||0,f=b||[];a=a||{};var g=null!=a.clockseq?a.clockseq:s,h=null!=a.msecs?a.msecs:(new Date).getTime(),i=null!=a.nsecs?a.nsecs:u+1,j=h-t+(i-u)/1e4;if(0>j&&null==a.clockseq&&(g=g+1&16383),(0>j||h>t)&&null==a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");t=h,u=i,s=g,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;f[e++]=k>>>24&255,f[e++]=k>>>16&255,f[e++]=k>>>8&255,f[e++]=255&k;var l=h/4294967296*1e4&268435455;f[e++]=l>>>8&255,f[e++]=255&l,f[e++]=l>>>24&15|16,f[e++]=l>>>16&255,f[e++]=g>>>8|128,f[e++]=255&g;for(var m=a.node||r,n=0;6>n;n++)f[e+n]=m[n];return b?b:d(f)}function f(a,b,c){var e=b&&c||0;"string"==typeof a&&(b="binary"==a?new m(16):null,a=null),a=a||{};var f=a.random||(a.rng||g)();if(f[6]=15&f[6]|64,f[8]=63&f[8]|128,b)for(var h=0;16>h;h++)b[e+h]=f[h];return b||d(f)}var g,h=this;if("function"==typeof h.require)try{var i=h.require("crypto").randomBytes;g=i&&function(){return i(16)}}catch(j){}if(!g&&h.crypto&&crypto.getRandomValues){var k=new Uint8Array(16);g=function(){return crypto.getRandomValues(k),k}}if(!g){var l=new Array(16);g=function(){for(var a,b=0;16>b;b++)0===(3&b)&&(a=4294967296*Math.random()),l[b]=a>>>((3&b)<<3)&255;return l}}for(var m="function"==typeof h.Buffer?h.Buffer:Array,n=[],o={},p=0;256>p;p++)n[p]=(p+256).toString(16).substr(1),o[n[p]]=p;var q=g(),r=[1|q[0],q[1],q[2],q[3],q[4],q[5]],s=16383&(q[6]<<8|q[7]),t=0,u=0,v=f;if(v.v1=e,v.v4=f,v.parse=b,v.unparse=d,v.BufferClass=m,"function"==typeof a&&a.amd)a(function(){return v});else if("undefined"!=typeof c&&c.exports)c.exports=v;else{var w=h.uuid;v.noConflict=function(){return h.uuid=w,v},h.uuid=v}}).call(this)},{}],77:[function(b,c,d){!function(b,e){"undefined"!=typeof d&&"undefined"!=typeof c?c.exports=e():"function"==typeof a&&"object"==typeof a.amd?a(e):this[b]=e()}("validator",function(a){"use strict";function b(a,b){a=a||{};for(var c in b)"undefined"==typeof a[c]&&(a[c]=b[c]);return a}a={version:"3.22.0"};var c=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,d=/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/,e=/^(?:[0-9]{9}X|[0-9]{10})$/,f=/^(?:[0-9]{13})$/,g=/^(\d?\d?\d)\.(\d?\d?\d)\.(\d?\d?\d)\.(\d?\d?\d)$/,h=/^::|^::1|^([a-fA-F0-9]{1,4}::?){1,7}([a-fA-F0-9]{1,4})$/,i={3:/^[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,4:/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,5:/^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,all:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i},j=/^[a-zA-Z]+$/,k=/^[a-zA-Z0-9]+$/,l=/^-?[0-9]+$/,m=/^(?:-?(?:0|[1-9][0-9]*))$/,n=/^(?:-?(?:[0-9]+))?(?:\.[0-9]*)?(?:[eE][\+\-]?(?:[0-9]+))?$/,o=/^[0-9a-fA-F]+$/,p=/^#?([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,q=/^[\x00-\x7F]+$/,r=/[^\x00-\x7F]/,s=/[^\u0020-\u007E\uFF61-\uFF9F\uFFA0-\uFFDC\uFFE8-\uFFEE0-9a-zA-Z]/,t=/[\u0020-\u007E\uFF61-\uFF9F\uFFA0-\uFFDC\uFFE8-\uFFEE0-9a-zA-Z]/,u=/[\uD800-\uDBFF][\uDC00-\uDFFF]/,v=/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=|[A-Za-z0-9+\/]{4})$/;a.extend=function(b,c){a[b]=function(){var b=Array.prototype.slice.call(arguments);return b[0]=a.toString(b[0]),c.apply(a,b)}},a.init=function(){for(var b in a)"function"==typeof a[b]&&"toString"!==b&&"toDate"!==b&&"extend"!==b&&"init"!==b&&a.extend(b,a[b])},a.toString=function(a){return"object"==typeof a&&null!==a&&a.toString?a=a.toString():null===a||"undefined"==typeof a||isNaN(a)&&!a.length?a="":"string"!=typeof a&&(a+=""),a},a.toDate=function(a){return"[object Date]"===Object.prototype.toString.call(a)?a:(a=Date.parse(a),isNaN(a)?null:new Date(a))},a.toFloat=function(a){return parseFloat(a)},a.toInt=function(a,b){return parseInt(a,b||10)},a.toBoolean=function(a,b){return b?"1"===a||"true"===a:"0"!==a&&"false"!==a&&""!==a},a.equals=function(b,c){return b===a.toString(c)},a.contains=function(b,c){return b.indexOf(a.toString(c))>=0},a.matches=function(a,b,c){return"[object RegExp]"!==Object.prototype.toString.call(b)&&(b=new RegExp(b,c)),b.test(a)},a.isEmail=function(a){return c.test(a)};var w={protocols:["http","https","ftp"],require_tld:!0,require_protocol:!1,allow_underscores:!1};a.isURL=function(c,d){if(!c||c.length>=2083)return!1;if(0===c.indexOf("mailto:"))return!1;d=b(d,w);var e,f,g,h,i,j,k,l,m,n,o;if(o=c.split("://"),o.length>1){if(e=o.shift(),-1===d.protocols.indexOf(e))return!1}else if(d.require_protocol)return!1;if(c=o.join("://"),o=c.split("#"),c=o.shift(),n=o.join("#"),n&&/\s/.test(n))return!1;if(o=c.split("?"),c=o.shift(),m=o.join("?"),m&&/\s/.test(m))return!1;if(o=c.split("/"),c=o.shift(),l=o.join("/"),l&&/\s/.test(l))return!1;if(o=c.split("@"),o.length>1&&(h=o.shift(),h.indexOf(":")>=0)){if(h=h.split(":"),f=h.shift(),!/^\S+$/.test(f))return!1;if(g=h.join(":"),!/^\S*$/.test(f))return!1}return j=o.join("@"),o=j.split(":"),i=o.shift(),o.length&&(k=parseInt(o.join(":"),10),0>=k||k>65535)?!1:a.isIP(i)||a.isFQDN(i,d)||"localhost"===i?d.host_whitelist&&-1===d.host_whitelist.indexOf(i)?!1:d.host_blacklist&&-1!==d.host_blacklist.indexOf(i)?!1:!0:!1},a.isIP=function(b,c){if(c=a.toString(c),!c)return a.isIP(b,4)||a.isIP(b,6);if("4"===c){if(!g.test(b))return!1;var d=b.split(".").sort(function(a,b){return a-b});return d[3]<=255}return"6"===c&&h.test(b)};var x={require_tld:!0,allow_underscores:!1};a.isFQDN=function(a,c){c=b(c,x);var d=a.split(".");if(c.require_tld){var e=d.pop();if(!d.length||!/^[a-z]{2,}$/i.test(e))return!1}for(var f,g=0;g<d.length;g++){if(f=d[g],c.allow_underscores){if(f.indexOf("__")>=0)return!1;f=f.replace(/_/g,"")}if(!/^[a-z\\u00a1-\\uffff0-9-]+$/i.test(f))return!1;if("-"===f[0]||"-"===f[f.length-1]||f.indexOf("---")>=0)return!1}return!0},a.isAlpha=function(a){return j.test(a)},a.isAlphanumeric=function(a){return k.test(a)},a.isNumeric=function(a){return l.test(a)},a.isHexadecimal=function(a){return o.test(a)},a.isHexColor=function(a){return p.test(a)},a.isLowercase=function(a){return a===a.toLowerCase()},a.isUppercase=function(a){return a===a.toUpperCase()},a.isInt=function(a){return m.test(a)},a.isFloat=function(a){return""!==a&&n.test(a)},a.isDivisibleBy=function(b,c){return a.toFloat(b)%a.toInt(c)===0},a.isNull=function(a){return 0===a.length},a.isLength=function(a,b,c){var d=a.match(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g)||[],e=a.length-d.length;return e>=b&&("undefined"==typeof c||c>=e)},a.isByteLength=function(a,b,c){return a.length>=b&&("undefined"==typeof c||a.length<=c)},a.isUUID=function(a,b){var c=i[b?b:"all"];return c&&c.test(a)},a.isDate=function(a){return!isNaN(Date.parse(a))},a.isAfter=function(b,c){var d=a.toDate(c||new Date),e=a.toDate(b);return!!(e&&d&&e>d)},a.isBefore=function(b,c){var d=a.toDate(c||new Date),e=a.toDate(b);return e&&d&&d>e},a.isIn=function(b,c){if(!c||"function"!=typeof c.indexOf)return!1;if("[object Array]"===Object.prototype.toString.call(c)){for(var d=[],e=0,f=c.length;f>e;e++)d[e]=a.toString(c[e]);c=d}return c.indexOf(b)>=0},a.isCreditCard=function(a){var b=a.replace(/[^0-9]+/g,"");if(!d.test(b))return!1;for(var c,e,f,g=0,h=b.length-1;h>=0;h--)c=b.substring(h,h+1),e=parseInt(c,10),f?(e*=2,g+=e>=10?e%10+1:e):g+=e,f=!f;return!!(g%10===0?b:!1)},a.isISBN=function(b,c){if(c=a.toString(c),!c)return a.isISBN(b,10)||a.isISBN(b,13);var d,g=b.replace(/[\s-]+/g,""),h=0;if("10"===c){if(!e.test(g))return!1;for(d=0;9>d;d++)h+=(d+1)*g.charAt(d);if(h+="X"===g.charAt(9)?100:10*g.charAt(9),h%11===0)return!!g}else if("13"===c){if(!f.test(g))return!1;var i=[1,3];for(d=0;12>d;d++)h+=i[d%2]*g.charAt(d);if(g.charAt(12)-(10-h%10)%10===0)return!!g}return!1},a.isJSON=function(a){try{JSON.parse(a)}catch(b){return!1}return!0},a.isMultibyte=function(a){return r.test(a)},a.isAscii=function(a){return q.test(a)},a.isFullWidth=function(a){return s.test(a)},a.isHalfWidth=function(a){return t.test(a)},a.isVariableWidth=function(a){return s.test(a)&&t.test(a)},a.isSurrogatePair=function(a){return u.test(a)},a.isBase64=function(a){return v.test(a)},a.isMongoId=function(b){return a.isHexadecimal(b)&&24===b.length},a.ltrim=function(a,b){var c=b?new RegExp("^["+b+"]+","g"):/^\s+/g;return a.replace(c,"")},a.rtrim=function(a,b){var c=b?new RegExp("["+b+"]+$","g"):/\s+$/g;return a.replace(c,"")},a.trim=function(a,b){var c=b?new RegExp("^["+b+"]+|["+b+"]+$","g"):/^\s+|\s+$/g;return a.replace(c,"")},a.escape=function(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},a.stripLow=function(b,c){var d=c?"\x00-	\f-":"\x00-";return a.blacklist(b,d)},a.whitelist=function(a,b){return a.replace(new RegExp("[^"+b+"]+","g"),"")},a.blacklist=function(a,b){return a.replace(new RegExp("["+b+"]+","g"),"")};var y={lowercase:!0};return a.normalizeEmail=function(c,d){if(d=b(d,y),!a.isEmail(c))return!1;var e=c.split("@",2);return e[1]=e[1].toLowerCase(),d.lowercase&&(e[0]=e[0].toLowerCase()),("gmail.com"===e[1]||"googlemail.com"===e[1])&&(d.lowercase||(e[0]=e[0].toLowerCase()),e[0]=e[0].replace(/\./g,"").split("+")[0],e[1]="gmail.com"),e.join("@")},a.init(),a})},{}]},{},[32])(32)});
